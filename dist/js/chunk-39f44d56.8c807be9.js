(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-39f44d56"],{"765e":function(t,e,o){},"84e4":function(t,e,o){"use strict";o("765e")},fb8b:function(t,e,o){"use strict";o.r(e);var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("a-card",{staticClass:"cardshadow",attrs:{bordered:!1}},[o("div",{staticClass:"flex alcenter between"},[o("a-radio-group",{attrs:{"button-style":"solid"},model:{value:t.document_type,callback:function(e){t.document_type=e},expression:"document_type"}},t._l(t.formData.document_type,(function(e,a){return o("a-radio",{key:a,attrs:{value:e.code}},[t._v(" "+t._s(e.name)+" ")])})),1),o("a-space",[o("h-button",{attrs:{loading:t.handleLoading,icon:"edit",type:"warning"},on:{click:t.handle}},[t._v("办理")]),o("h-button",{attrs:{loading:t.saveLoading,icon:"save",type:"success"},on:{click:t.save}},[t._v("保存")])],1)],1),o("a-divider"),"1"===t.document_type?o("table",{staticClass:"custom-table"},[o("tbody",[o("tr",{staticClass:"ht50"},[o("td",{staticClass:"tc bold red1",attrs:{colspan:"4"}},[t._v("东营市晨阳学校文件处理单")])]),o("tr",[o("td",{staticClass:"wt120 tc bold red1"},[o("span",{staticClass:"posRelt star"},[t._v("来文单位")])]),o("td",[o("a-input",{staticStyle:{height:"48px",border:"none"},attrs:{placeholder:"请输入来文单位 (必填)"},model:{value:t.form1.document_unit,callback:function(e){t.$set(t.form1,"document_unit",e)},expression:"form1.document_unit"}})],1),o("td",{staticClass:"wt120 tc bold red1"},[t._v("来文时间")]),o("td",{staticStyle:{width:"260px"}},[o("a-date-picker",{staticStyle:{width:"100%",display:"inline-block"},attrs:{valueFormat:"YYYY-MM-DD"},model:{value:t.form1.document_time,callback:function(e){t.$set(t.form1,"document_time",e)},expression:"form1.document_time"}},[t.form1.document_time?o("div",{staticClass:"plr5"},[t._v(t._s(t.form1.document_time))]):o("div",{staticClass:"plr10 corb8"},[t._v("请选择来文时间")])])],1)]),o("tr",[o("td",{staticClass:"wt120 tc bold red1"},[t._v("来文字号")]),o("td",[o("a-input",{staticStyle:{height:"48px",border:"none"},attrs:{placeholder:"请输入来文字号"},model:{value:t.form1.document_font_size,callback:function(e){t.$set(t.form1,"document_font_size",e)},expression:"form1.document_font_size"}})],1),o("td",{staticClass:"wt120 tc bold red1"},[o("span",{staticClass:"posRelt star"},[t._v("收文字号")])]),o("td",[o("a-input",{staticStyle:{height:"48px",border:"none"},attrs:{placeholder:"请输入收文字号 (必填)"},model:{value:t.form1.received_font_size,callback:function(e){t.$set(t.form1,"received_font_size",e)},expression:"form1.received_font_size"}})],1)]),o("tr",[o("td",{staticClass:"wt120 tc bold red1"},[o("span",{staticClass:"posRelt star"},[t._v("来文标题")])]),o("td",{attrs:{colspan:"3"}},[o("a-input",{staticStyle:{height:"48px",border:"none"},attrs:{placeholder:"请输入来文标题 (必填)"},model:{value:t.form1.document_title,callback:function(e){t.$set(t.form1,"document_title",e)},expression:"form1.document_title"}})],1)]),o("tr",[o("td",{staticClass:"wt120 tc bold red1"},[t._v("份数（份）")]),o("td",[o("a-input-number",{staticStyle:{width:"100%",height:"48px",border:"none"},attrs:{min:0,placeholder:"请输入份数"},model:{value:t.form1.number,callback:function(e){t.$set(t.form1,"number",e)},expression:"form1.number"}})],1),o("td",{staticClass:"wt120 tc bold red1"},[t._v("密级")]),o("td",[o("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择密级"},model:{value:t.form1.confidentiality_level,callback:function(e){t.$set(t.form1,"confidentiality_level",e)},expression:"form1.confidentiality_level"}},t._l(t.formData.confidentiality_level,(function(e){return o("a-select-option",{key:e.code,attrs:{value:e.code}},[t._v(" "+t._s(e.value)+" ")])})),1)],1)]),o("tr",{staticClass:"ht50"},[o("td",{staticClass:"wt120 tc bold red1"},[t._v("办理时限")]),o("td",{attrs:{colspan:"3"}},[o("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择办理时限"},model:{value:t.form1.time_limit,callback:function(e){t.$set(t.form1,"time_limit",e)},expression:"form1.time_limit"}},t._l(t.formData.time_limit,(function(e){return o("a-select-option",{key:e.code,attrs:{value:e.code}},[t._v(" "+t._s(e.value)+" ")])})),1)],1)]),o("tr",{staticClass:"ht50"},[o("td",{staticClass:"wt120 tc bold red1"},[t._v("来文正文")]),o("td",{staticClass:"plr10",attrs:{colspan:"3"}},[o("NewFileUpload",{attrs:{btnText:"上传文件"},model:{value:t.form1.document_text_list,callback:function(e){t.$set(t.form1,"document_text_list",e)},expression:"form1.document_text_list"}})],1)]),o("tr",{staticClass:"ht50"},[o("td",{staticClass:"wt120 tc bold red1"},[t._v("来文附件")]),o("td",{staticClass:"plr10",attrs:{colspan:"3"}},[o("NewFileUpload",{attrs:{btnText:"上传附件"},model:{value:t.form1.file_list,callback:function(e){t.$set(t.form1,"file_list",e)},expression:"form1.file_list"}})],1)])])]):t._e(),"2"===t.document_type?o("table",{staticClass:"custom-table"},[o("tbody",[o("tr",[o("td",{staticClass:"wt120 tc bold red1"},[o("span",{staticClass:"posRelt star"},[t._v("文件标题")])]),o("td",{attrs:{colspan:"3"}},[o("a-input",{staticStyle:{height:"48px",border:"none"},attrs:{placeholder:"请输入文件标题 (必填)"},model:{value:t.form2.document_title,callback:function(e){t.$set(t.form2,"document_title",e)},expression:"form2.document_title"}})],1)]),o("tr",{staticClass:"ht50"},[o("td",{staticClass:"wt120 tc bold red1"},[t._v("附件")]),o("td",{staticClass:"plr10",attrs:{colspan:"3"}},[o("NewFileUpload",{attrs:{btnText:"上传附件"},on:{change:t.onchangeFileInSchool},model:{value:t.form2.file_list,callback:function(e){t.$set(t.form2,"file_list",e)},expression:"form2.file_list"}})],1)]),o("tr",[o("td",{staticClass:"wt120 tc bold red1"},[t._v("拟稿科室")]),o("td",{attrs:{colspan:"3"}},[o("a-input",{staticStyle:{height:"48px",border:"none"},attrs:{placeholder:"请输入拟稿科室"},model:{value:t.form2.drafting_department,callback:function(e){t.$set(t.form2,"drafting_department",e)},expression:"form2.drafting_department"}})],1)]),o("tr",[o("td",{staticClass:"wt120 tc bold red1"},[t._v("拟稿人")]),o("td",{attrs:{colspan:"3"}},[o("a-input",{staticStyle:{height:"48px",border:"none"},attrs:{placeholder:"请输入拟稿人"},model:{value:t.form2.drafter,callback:function(e){t.$set(t.form2,"drafter",e)},expression:"form2.drafter"}})],1)]),o("tr",[o("td",{staticClass:"wt120 tc bold red1"},[t._v("发文时间")]),o("td",{staticStyle:{width:"260px"}},[o("a-date-picker",{staticStyle:{width:"100%",display:"inline-block"},attrs:{valueFormat:"YYYY-MM-DD"},model:{value:t.form2.document_send_time,callback:function(e){t.$set(t.form2,"document_send_time",e)},expression:"form2.document_send_time"}},[t.form2.document_send_time?o("div",{staticClass:"plr5"},[t._v(t._s(t.form2.document_send_time))]):o("div",{staticClass:"plr10 corb8"},[t._v("请选择发文时间")])])],1),o("td",{staticClass:"wt80 tc bold red1"},[o("span",{staticClass:"posRelt star"},[t._v("文号")])]),o("td",[o("div",{staticClass:"flex alcenter"},[o("a-select",{staticStyle:{flex:"1"},attrs:{placeholder:"请选择"},model:{value:t.form2.document_number_prefix,callback:function(e){t.$set(t.form2,"document_number_prefix",e)},expression:"form2.document_number_prefix"}},t._l(t.formData.document_number_prefix,(function(e){return o("a-select-option",{key:e.code,attrs:{value:e.code}},[t._v(" "+t._s(e.value)+" ")])})),1),o("div",{staticClass:"wt60"},[t._v("【"+t._s(t.form2.document_number_year)+"】")]),o("a-input-number",{staticStyle:{flex:"1",height:"48px",border:"none"},attrs:{min:0,placeholder:"文号 (必填)"},model:{value:t.form2.document_number,callback:function(e){t.$set(t.form2,"document_number",e)},expression:"form2.document_number"}})],1)])]),o("tr",[o("td",{staticClass:"wt120 tc bold red1"},[t._v("印刷份数")]),o("td",{attrs:{colspan:"3"}},[o("a-input-number",{staticStyle:{width:"100%",height:"48px",border:"none"},attrs:{min:0,placeholder:"请输入份数"},model:{value:t.form2.printing_number,callback:function(e){t.$set(t.form2,"printing_number",e)},expression:"form2.printing_number"}})],1)])])]):t._e(),o("div",{staticClass:"flex jscenter mt20"},[o("a-button",{attrs:{icon:"delete",type:"danger"},on:{click:t.onClearForm}},[t._v("内容重置新发文")])],1),o("HandleForm",{ref:"HandleForm",on:{ok:t.onClearForm}})],1)],1)},i=[],n=o("c964"),s=(o("96cf"),o("d81d"),o("4de4"),o("caad"),o("2532"),o("d3b7"),o("159b"),o("a15b"),o("2af9")),r=o("126f"),c=o("e5f9"),l=o("1fb4"),d={components:{STable:s["r"],XCard:s["w"],HandleForm:l["default"]},data:function(){return{formData:{document_type:[],haveCirculationRole:[],haveCirculationRoleCode:[],allCirculationRoles:[{id:624000270828037,code:"office_archivist",name:"办公室档案员"},{id:624000511341061,code:"director_of_office",name:"办公室主任"},{id:624001084617221,code:"middle_level",name:"中层"},{id:624000931480069,code:"vice_principal",name:"副校长、工会主席、校长助理"},{id:624000669082117,code:"principal",name:"段校长"}],confidentiality_level:[],time_limit:[],document_number_prefix:[]},circulation_id:null,document_id:null,document_type:"1",form1:{number:0,document_time:"",confidentiality_level:"1",time_limit:"1",document_text_list:[],file_list:[]},form2:{document_title:"",document_send_time:"",document_number_prefix:"1",document_number_year:"",printing_number:1,file_list:[]},saveLoading:!1,handleLoading:!1}},created:function(){this.getRole(),this.dictTypeDropDown()},methods:{getRole:function(){var t=this.formData.allCirculationRoles.map((function(t){return t.code}));this.formData.haveCirculationRole=this.$userInfo.roles.filter((function(e){return t.includes(e.code)})),this.formData.haveCirculationRoleCode=this.formData.haveCirculationRole.map((function(t){return t.code})),this.formData.haveCirculationRoleCode.includes("office_archivist")&&this.formData.haveCirculationRoleCode.includes("middle_level")?(this.formData.document_type=[{code:"1",name:"上级来文"},{code:"2",name:"校内文件"}],this.document_type="1"):this.formData.haveCirculationRoleCode.includes("office_archivist")?(this.formData.document_type=[{code:"1",name:"上级来文"}],this.document_type="1"):this.formData.haveCirculationRoleCode.includes("middle_level")&&(this.formData.document_type=[{code:"2",name:"校内文件"}],this.document_type="2")},dictTypeDropDown:function(){var t=this;Object(r["c"])({code:"confidentiality_level"}).then((function(e){t.formData.confidentiality_level=e.data||[]})),Object(r["c"])({code:"time_limit"}).then((function(e){t.formData.time_limit=e.data||[]})),Object(r["c"])({code:"document_number_prefix"}).then((function(e){t.formData.document_number_prefix=e.data||[]})),this.form2.document_send_time=this.$moment().format("YYYY-MM-DD"),this.form2.document_number_year=this.$moment().format("YYYY")},onchangeFileInSchool:function(t){if(t.length){var e=t[0],o=e&&e.fileOriginName;this.form2.document_title=o.substring(0,o.lastIndexOf("."))}},onClearForm:function(){this.document_id=null,this.circulation_id=null,"1"===this.document_type&&(this.form1=Object.assign({},this.$options.data().form1)),"2"===this.document_type&&(this.form2=Object.assign({},this.$options.data().form2),this.form2.document_send_time=this.$moment().format("YYYY-MM-DD"),this.form2.document_number_year=this.$moment().format("YYYY"))},save:function(){this.saveLoading=!0,this.postData()},handle:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.postData();case 2:if(o=e.sent,o){e.next=5;break}return e.abrupt("return",!1);case 5:t.$refs.HandleForm.edit({id:t.circulation_id,document_id:t.document_id,document_type:t.document_type,step:1,current_step:{current_step:"1"===t.document_type?"office_archivist":"2"===t.document_type?"middle_level":"",current_step_name:"1"===t.document_type?"办公室档案员":"2"===t.document_type?"中层领导":""}});case 6:case"end":return e.stop()}}),e)})))()},postData:function(){var t=this,e=this;return new Promise((function(o){var a="1"===e.document_type?JSON.parse(JSON.stringify(e.form1)):JSON.parse(JSON.stringify(e.form2));if(a.document_type=e.document_type,Array.isArray(a.document_text_list)){var i=[];a.document_text_list.forEach((function(t){i.push(t.id)})),a.document_text=i.join("|")}if(delete a.document_text_list,Array.isArray(a.file_list)){var n=[];a.file_list.forEach((function(t){n.push(t.id)})),a.files=n.join("|")}if(delete a.file_list,!e.check(a,e))return o(!1),!1;e.handleLoading=!0,e.document_id?(a.id=t.document_id,Object(c["c"])(a).then((function(t){t.success?(e.$message.success("更新成功！"),o(!0)):(e.$message.error(JSON.stringify(t.message)),o(!1)),e.saveLoading=!1,e.handleLoading=!1}))):Object(c["a"])(a).then((function(t){t.success?(e.$message.success("保存成功！"),e.document_id=t.data.document_id,e.circulation_id=t.data.circulation_id,o(!0)):(e.$message.error(JSON.stringify(t.message)),o(!1)),e.saveLoading=!1,e.handleLoading=!1}))}))},check:function(t){var e=!0;return"1"===t.document_type?(t.document_unit||(this.$message.error("未填写来文单位"),e=!1),t.received_font_size||(this.$message.error("未填写收文字号"),e=!1),t.document_title||(this.$message.error("未填写来文标题"),e=!1)):"2"===t.document_type&&(t.document_title||(this.$message.error("未填写文件标题"),e=!1),t.document_number||(this.$message.error("未填写文号"),e=!1)),e}}},m=d,u=(o("84e4"),o("0c7c")),f=Object(u["a"])(m,a,i,!1,null,"ebc93128",null);e["default"]=f.exports}}]);