(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-43f41876","chunk-23fff7db"],{"1fb4":function(e,t,o){"use strict";o.r(t);var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("a-modal",{attrs:{title:e.title,width:1100,confirmLoading:e.confirmLoading},on:{ok:e.handleOk},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[o("a-form-model",{ref:"ruleForm",attrs:{model:e.formContent,"label-col":e.labelCol,"wrapper-col":e.wrapperCol,rules:e.rules}},["2"===e.formContent.document_type&&["vice_principal","principal"].includes(e.formData.haveCirculationRoles.code)?o("a-form-model-item",{attrs:{label:"审批结果",prop:"approval_result"}},[o("a-radio-group",{on:{change:e.onChangeApprovalResult},model:{value:e.formContent.approval_result,callback:function(t){e.$set(e.formContent,"approval_result",t)},expression:"formContent.approval_result"}},[o("a-radio",{attrs:{value:"1"}},[e._v("通过")]),o("a-radio",{attrs:{value:"2"}},[e._v("不通过")])],1)],1):e._e(),o("a-form-model-item",{attrs:{label:"办理意见",prop:"processing_opinions"}},[o("a-textarea",{attrs:{placeholder:"请输入办理意见(最多500个字符)",allowClear:!0,"auto-size":{minRows:4}},model:{value:e.formContent.processing_opinions,callback:function(t){e.$set(e.formContent,"processing_opinions",t)},expression:"formContent.processing_opinions"}}),o("div",{staticClass:"flex jsend",staticStyle:{"margin-top":"-15px"}},[o("a-dropdown",{model:{value:e.visibleApprove,callback:function(t){e.visibleApprove=t},expression:"visibleApprove"}},[o("a",{staticClass:"ant-dropdown-link",on:{click:function(e){return e.preventDefault()}}},[e._v(" 从批语库中选择 "),o("a-icon",{attrs:{type:"down"}})],1),o("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},e._l(e.formData.approve,(function(t,n){return o("a-menu-item",{key:n,on:{click:function(o){e.formContent.processing_opinions+=t.approve_name+"、"}}},[e._v(" "+e._s(t.approve_name)+" ")])})),1)],1)],1)],1),o("a-form-model-item",{attrs:{label:"流转节点",prop:"current_step"}},[o("a-radio-group",{on:{change:e.onChangeCurrentStep},model:{value:e.formContent.current_step,callback:function(t){e.$set(e.formContent,"current_step",t)},expression:"formContent.current_step"}},e._l(e.formData.selectableRoles,(function(t,n){return o("a-radio",{key:n,attrs:{value:t.code}},[e._v(" "+e._s(t.name)+" ")])})),1)],1),"end"!==e.formContent.current_step?o("a-form-model-item",{attrs:{label:"办理人",required:""}},[o("div",{staticClass:"flex"},[o("div",{staticClass:"flex3 plr10 ptb5 w100 bde7 radius6",staticStyle:{"min-height":"240px"}},[o("a-input-search",{staticClass:"radius40 overxy ttBk",attrs:{placeholder:"输入人员姓名搜索"},on:{search:e.onSearchUserName},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),e.formData.userList.length?o("div",{staticClass:"mb10 bdbe7",staticStyle:{"margin-top":"-10px"}},[o("a-checkbox",{attrs:{checked:e.checkAll},on:{change:e.onCheckAllChange}},[e._v("全选")])],1):e._e(),e.formData.userList.length?o("div",{staticStyle:{"max-height":"300px","overflow-y":"auto"}},[o("a-checkbox-group",{staticStyle:{width:"100%"},on:{change:e.onSelUser},model:{value:e.formContent.current_personnel,callback:function(t){e.$set(e.formContent,"current_personnel",t)},expression:"formContent.current_personnel"}},[o("a-row",e._l(e.formData.userList,(function(t,n){return o("a-col",{key:n,attrs:{span:4}},[o("a-checkbox",{attrs:{value:t.id,disabled:e.formContent.current_personnel.includes(t.id)}},[e._v(" "+e._s(t.name)+" ")])],1)})),1)],1)],1):o("div",{staticClass:"flex jscenter ptb20"},[o("a-spin",{attrs:{tip:"获取数据..."}})],1)],1),o("data",{staticClass:"wt10"}),o("div",{staticClass:"flex1 pb5 w100 bde7 radius6",staticStyle:{"min-height":"240px"}},[o("div",{staticClass:"bgf6 plr10"},[e._v("已选人员：")]),e._l(e.selRoleUser,(function(t,n){return o("div",{key:n,staticClass:"bdbe7 plr10"},[o("div",{staticClass:"bold red mr5 ft12"},[e._v(e._s(t.name)+":")]),e._l(t.selUser,(function(n,r){return o("div",{key:r,staticClass:"ht30 flex between alcenter"},[o("span",[e._v(e._s(n.name))]),o("a-tag",{attrs:{color:"red"},on:{click:function(o){return e.onRemoveUser(t,n)}}},[e._v("移除")])],1)}))],2)})),e.selRoleUser.length?e._e():o("a-empty",{staticStyle:{"margin-top":"20px"},attrs:{description:"未选人员"}})],2)])]):e._e()],1)],1)],1)},r=[],a=(o("4de4"),o("b0c0"),o("7db0"),o("d81d"),o("159b"),o("caad"),o("2532"),o("99af"),o("a434"),o("4ec9"),o("d3b7"),o("3ca3"),o("ddb0"),o("a15b"),o("a6dd")),i=o("ce85"),s=o("0901"),c={data:function(){return{visibleApprove:!1,visible:!1,confirmLoading:!1,title:"办理",labelCol:{span:3},wrapperCol:{span:20},rules:{approval_result:[{required:!0,message:"请选择审批结果",trigger:"change"}],current_step:[{required:!0,message:"请选择流转节点",trigger:"change"}],processing_opinions:[{required:!0,message:"请输入办理意见",trigger:"blur"}]},formData:{haveCirculationRoles:{},selectableRoles:[],allCirculationRoles:[{code:"principal",name:"段校长",selUser:[]},{code:"vice_principal",name:"副校长、工会主席、校长助理",selUser:[]},{code:"middle_level",name:"中层",selUser:[]},{code:"director_of_office",name:"办公室主任",selUser:[]},{code:"office_archivist",name:"办公室档案员",selUser:[]},{code:"clerk",name:"文书员",selUser:[]},{code:"pt",name:"普通员工",selUser:[]}],approve:[],userList:[],userTotal:0,userPageNo:1},formContent:{approval_result:"1",processing_opinions:"",current:[],current_step:"",current_personnel:[]},username:"",checkAll:!1}},computed:{selRoleUser:function(){var e=this.formData.allCirculationRoles.filter((function(e){return e.selUser.length>0}));return e}},methods:{getApprove:function(){var e=this;Object(a["d"])({pageNo:1,pageSize:100}).then((function(t){t.success&&(e.formData.approve=t.data.rows)}))},edit:function(e){this.visible=!0,this.getApprove(),this.formData=Object.assign({},this.$options.data().formData),this.formData.haveCirculationRoles={code:e.current_step.current_step,name:e.current_step.current_step_name},this.formContent=Object.assign({},this.$options.data().formContent,e),this.formContent.previous_step=this.formData.haveCirculationRoles.code,this.formContent.previous_personnel=this.$userInfo.id,this.setTitle(),this.setShowRole()},setTitle:function(){1===this.formContent.step?"1"===this.formContent.document_type?this.title="当前节点：办公室档案员【开始】":"2"===this.formContent.document_type&&(this.title="当前节点：中层【开始】"):this.title="当前节点：".concat(this.formData.haveCirculationRoles.name)},setShowRole:function(){var e="",t=[];"1"===this.formContent.document_type?"office_archivist"===this.formData.haveCirculationRoles.code?(t=[{code:"director_of_office",name:"办公室主任"}],e="director_of_office"):"director_of_office"===this.formData.haveCirculationRoles.code?(t=[{code:"principal",name:"段校长"},{code:"vice_principal",name:"副校长、工会主席、校长助理"},{code:"middle_level",name:"中层"},{code:"pt",name:"普通员工"},{code:"end",name:"结束"}],e="principal"):"principal"===this.formData.haveCirculationRoles.code?(t=[{code:"director_of_office",name:"办公室主任"}],e="director_of_office"):"vice_principal"===this.formData.haveCirculationRoles.code?(t=[{code:"middle_level",name:"中层"},{code:"end",name:"结束"}],e="middle_level"):"middle_level"===this.formData.haveCirculationRoles.code?(t=[{code:"pt",name:"普通员工"},{code:"end",name:"结束"}],e="pt"):"pt"===this.formData.haveCirculationRoles.code&&(t=[{code:"end",name:"结束"}],e="end"):"2"===this.formContent.document_type&&("middle_level"===this.formData.haveCirculationRoles.code?(t=[{code:"vice_principal",name:"副校长、工会主席、校长助理"}],e="vice_principal"):"vice_principal"===this.formData.haveCirculationRoles.code?"1"===this.formContent.approval_result?(t=[{code:"principal",name:"段校长"}],e="principal"):(t=[{code:"middle_level",name:"中层"}],e="middle_level"):"principal"===this.formData.haveCirculationRoles.code?(t=[{code:"director_of_office",name:"办公室主任"}],e="director_of_office"):"director_of_office"===this.formData.haveCirculationRoles.code?(t=[{code:"middle_level",name:"中层"},{code:"clerk",name:"文书员"}],e="clerk"):"clerk"===this.formData.haveCirculationRoles.code&&(t=[{code:"end",name:"结束"}],e="end")),this.formData.selectableRoles=t,this.formContent.current_step=e,"end"!==e&&this.getUser({sysRoleCode:e})},onChangeApprovalResult:function(e){this.setShowRole()},onChangeCurrentStep:function(e){var t=e.target.value;"end"!==t&&this.getUser({sysRoleCode:t}),this.username=""},onSearchUserName:function(e){this.getUser({searchValue:e})},onChangeUserPage:function(e,t){this.getUser({pageNo:e})},getUser:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.formData.userList=[];var o=this.formData.allCirculationRoles.find((function(t){return t.code===e.formContent.current_step})),n={};n="1"===this.formContent.document_type&&"middle_level"===this.formData.haveCirculationRoles.code?{pageNo:1,pageSize:350,sysRoleCode:this.formContent.current_step,"sysEmpParam.orgId":this.$userInfo.loginEmpInfo.orgId}:{pageNo:1,pageSize:350,sysRoleCode:this.formContent.current_step};var r=Object.assign({},n,t);Object(s["a"])(r).then((function(t){t.success&&(e.formData.userList=t.data.rows||[],e.formData.userTotal=t.data.totalRows||0,e.formData.userPageNo=t.data.pageNo||1,o.selUser.length?e.formContent.current_personnel=o.selUser.map((function(e){return e.id})):1===e.formData.userList.length&&"2"===e.formContent.document_type&&"vice_principal"===e.formData.haveCirculationRoles.code&&"1"===e.formContent.approval_result?(e.formContent.current_personnel=[e.formData.userList[0].id],o.selUser=e.formData.userList):e.formContent.current_personnel=[],o.selUser.length===e.formData.userList.length?e.checkAll=!0:e.checkAll=!1)}))},onCheckAllChange:function(e){var t=this;this.checkAll=e.target.checked,this.checkAll?this.formContent.current_personnel=this.formData.userList.map((function(e){return e.id})):this.formContent.current_personnel=[],this.formData.allCirculationRoles.forEach((function(e){e.code===t.formContent.current_step&&(e.selUser=t.checkAll?t.formData.userList:[])}))},onSelUser:function(e){var t=this,o=this.formData.userList.filter((function(t){return e.includes(t.id)}));this.formData.allCirculationRoles.forEach((function(e){e.code===t.formContent.current_step&&(e.selUser=t.unique(e.selUser.concat(o)))}))},onRemoveUser:function(e,t){var o=this;e.selUser.forEach((function(n,r){n.id===t.id&&(e.selUser.splice(r,1),e.code===o.formContent.current_step&&(o.formContent.current_personnel=e.selUser.map((function(e){return e.id}))))}))},unique:function(e){var t=new Map;return e.filter((function(e){return!t.has(e.id)&&t.set(e.id,1)}))},handleOk:function(){var e=this;this.$refs.ruleForm.validate((function(t){if(!t||!e.check())return!1;var o=JSON.parse(JSON.stringify(e.formContent));delete o.current_step,delete o.current_personnel,e.confirmLoading=!0,Object(i["c"])(o).then((function(t){t.success?(e.visible=!1,e.$message.success("办理成功！"),e.$emit("ok")):e.$message.error(JSON.stringify(t.message)),e.confirmLoading=!1}))}))},check:function(){var e=!0;if("end"===this.formContent.current_step)this.formContent.current=[{current_step:"end",current_personnel:""}],e=!0;else if(this.selRoleUser.length){var t=[];this.selRoleUser.forEach((function(e){var o={current_step:e.code,current_personnel:e.selUser.map((function(e){return e.id})).join("|")};t.push(o)})),this.formContent.current=t,e=!0}else this.$message.error("未选择办理人"),e=!1;return e}}},l=c,d=(o("ba9b"),o("0c7c")),u=Object(d["a"])(l,n,r,!1,null,"3170b202",null);t["default"]=u.exports},"765e":function(e,t,o){},"84e4":function(e,t,o){"use strict";o("765e")},a6dd:function(e,t,o){"use strict";o.d(t,"a",(function(){return r})),o.d(t,"c",(function(){return a})),o.d(t,"b",(function(){return i})),o.d(t,"d",(function(){return s}));var n=o("b775");function r(e){return Object(n["b"])({url:"/ApproveDatabase/Create",method:"post",data:e})}function a(e){return Object(n["b"])({url:"/ApproveDatabase/Edit",method:"post",data:e})}function i(e){return Object(n["b"])({url:"/ApproveDatabase/Del",method:"post",data:e})}function s(e){return Object(n["b"])({url:"/ApproveDatabase/Get",method:"get",params:e})}},ba9b:function(e,t,o){"use strict";o("f409")},ce85:function(e,t,o){"use strict";o.d(t,"c",(function(){return r})),o.d(t,"a",(function(){return a})),o.d(t,"b",(function(){return i}));var n=o("b775");function r(e){return Object(n["b"])({url:"/CirculationLog/Update",method:"post",data:e})}function a(e){return Object(n["b"])({url:"/CirculationLog/Get",method:"get",params:e})}function i(e){return Object(n["b"])({url:"/CirculationLog/GetMyDo",method:"get",params:e})}},e5f9:function(e,t,o){"use strict";o.d(t,"a",(function(){return r})),o.d(t,"c",(function(){return a})),o.d(t,"b",(function(){return i})),o.d(t,"d",(function(){return s})),o.d(t,"e",(function(){return c}));var n=o("b775");function r(e){return Object(n["b"])({url:"/DocumentLog/Create",method:"post",data:e})}function a(e){return Object(n["b"])({url:"/DocumentLog/Edit",method:"post",data:e})}function i(e){return Object(n["b"])({url:"/DocumentLog/Del",method:"post",data:e})}function s(e){return Object(n["b"])({url:"/DocumentLog/Get",method:"get",params:e})}function c(e){return Object(n["b"])({url:"/DocumentLog/Detail",method:"get",params:e})}},f409:function(e,t,o){},fb8b:function(e,t,o){"use strict";o.r(t);var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("a-card",{staticClass:"cardshadow",attrs:{bordered:!1}},[o("div",{staticClass:"flex alcenter between"},[o("a-radio-group",{attrs:{"button-style":"solid"},model:{value:e.document_type,callback:function(t){e.document_type=t},expression:"document_type"}},e._l(e.formData.document_type,(function(t,n){return o("a-radio",{key:n,attrs:{value:t.code}},[e._v(" "+e._s(t.name)+" ")])})),1),o("a-space",[o("h-button",{attrs:{loading:e.handleLoading,icon:"edit",type:"warning"},on:{click:e.handle}},[e._v("办理")]),o("h-button",{attrs:{loading:e.saveLoading,icon:"save",type:"success"},on:{click:e.save}},[e._v("保存")])],1)],1),o("a-divider"),"1"===e.document_type?o("table",{staticClass:"custom-table"},[o("tbody",[o("tr",{staticClass:"ht50"},[o("td",{staticClass:"tc bold red1",attrs:{colspan:"4"}},[e._v("东营市晨阳学校文件处理单")])]),o("tr",[o("td",{staticClass:"wt120 tc bold red1"},[o("span",{staticClass:"posRelt star"},[e._v("来文单位")])]),o("td",[o("a-input",{staticStyle:{height:"48px",border:"none"},attrs:{placeholder:"请输入来文单位 (必填)"},model:{value:e.form1.document_unit,callback:function(t){e.$set(e.form1,"document_unit",t)},expression:"form1.document_unit"}})],1),o("td",{staticClass:"wt120 tc bold red1"},[e._v("来文时间")]),o("td",{staticStyle:{width:"260px"}},[o("a-date-picker",{staticStyle:{width:"100%",display:"inline-block"},attrs:{valueFormat:"YYYY-MM-DD"},model:{value:e.form1.document_time,callback:function(t){e.$set(e.form1,"document_time",t)},expression:"form1.document_time"}},[e.form1.document_time?o("div",{staticClass:"plr5"},[e._v(e._s(e.form1.document_time))]):o("div",{staticClass:"plr10 corb8"},[e._v("请选择来文时间")])])],1)]),o("tr",[o("td",{staticClass:"wt120 tc bold red1"},[e._v("来文字号")]),o("td",[o("a-input",{staticStyle:{height:"48px",border:"none"},attrs:{placeholder:"请输入来文字号"},model:{value:e.form1.document_font_size,callback:function(t){e.$set(e.form1,"document_font_size",t)},expression:"form1.document_font_size"}})],1),o("td",{staticClass:"wt120 tc bold red1"},[o("span",{staticClass:"posRelt star"},[e._v("收文字号")])]),o("td",[o("a-input",{staticStyle:{height:"48px",border:"none"},attrs:{placeholder:"请输入收文字号 (必填)"},model:{value:e.form1.received_font_size,callback:function(t){e.$set(e.form1,"received_font_size",t)},expression:"form1.received_font_size"}})],1)]),o("tr",[o("td",{staticClass:"wt120 tc bold red1"},[o("span",{staticClass:"posRelt star"},[e._v("来文标题")])]),o("td",{attrs:{colspan:"3"}},[o("a-input",{staticStyle:{height:"48px",border:"none"},attrs:{placeholder:"请输入来文标题 (必填)"},model:{value:e.form1.document_title,callback:function(t){e.$set(e.form1,"document_title",t)},expression:"form1.document_title"}})],1)]),o("tr",[o("td",{staticClass:"wt120 tc bold red1"},[e._v("份数（份）")]),o("td",[o("a-input-number",{staticStyle:{width:"100%",height:"48px",border:"none"},attrs:{min:0,placeholder:"请输入份数"},model:{value:e.form1.number,callback:function(t){e.$set(e.form1,"number",t)},expression:"form1.number"}})],1),o("td",{staticClass:"wt120 tc bold red1"},[e._v("密级")]),o("td",[o("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择密级"},model:{value:e.form1.confidentiality_level,callback:function(t){e.$set(e.form1,"confidentiality_level",t)},expression:"form1.confidentiality_level"}},e._l(e.formData.confidentiality_level,(function(t){return o("a-select-option",{key:t.code,attrs:{value:t.code}},[e._v(" "+e._s(t.value)+" ")])})),1)],1)]),o("tr",{staticClass:"ht50"},[o("td",{staticClass:"wt120 tc bold red1"},[e._v("办理时限")]),o("td",{attrs:{colspan:"3"}},[o("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择办理时限"},model:{value:e.form1.time_limit,callback:function(t){e.$set(e.form1,"time_limit",t)},expression:"form1.time_limit"}},e._l(e.formData.time_limit,(function(t){return o("a-select-option",{key:t.code,attrs:{value:t.code}},[e._v(" "+e._s(t.value)+" ")])})),1)],1)]),o("tr",{staticClass:"ht50"},[o("td",{staticClass:"wt120 tc bold red1"},[e._v("来文正文")]),o("td",{staticClass:"plr10",attrs:{colspan:"3"}},[o("NewFileUpload",{attrs:{btnText:"上传文件"},model:{value:e.form1.document_text_list,callback:function(t){e.$set(e.form1,"document_text_list",t)},expression:"form1.document_text_list"}})],1)]),o("tr",{staticClass:"ht50"},[o("td",{staticClass:"wt120 tc bold red1"},[e._v("来文附件")]),o("td",{staticClass:"plr10",attrs:{colspan:"3"}},[o("NewFileUpload",{attrs:{btnText:"上传附件"},model:{value:e.form1.file_list,callback:function(t){e.$set(e.form1,"file_list",t)},expression:"form1.file_list"}})],1)])])]):e._e(),"2"===e.document_type?o("table",{staticClass:"custom-table"},[o("tbody",[o("tr",[o("td",{staticClass:"wt120 tc bold red1"},[o("span",{staticClass:"posRelt star"},[e._v("文件标题")])]),o("td",{attrs:{colspan:"3"}},[o("a-input",{staticStyle:{height:"48px",border:"none"},attrs:{placeholder:"请输入文件标题 (必填)"},model:{value:e.form2.document_title,callback:function(t){e.$set(e.form2,"document_title",t)},expression:"form2.document_title"}})],1)]),o("tr",{staticClass:"ht50"},[o("td",{staticClass:"wt120 tc bold red1"},[e._v("附件")]),o("td",{staticClass:"plr10",attrs:{colspan:"3"}},[o("NewFileUpload",{attrs:{btnText:"上传附件"},on:{change:e.onchangeFileInSchool},model:{value:e.form2.file_list,callback:function(t){e.$set(e.form2,"file_list",t)},expression:"form2.file_list"}})],1)]),o("tr",[o("td",{staticClass:"wt120 tc bold red1"},[e._v("拟稿科室")]),o("td",{attrs:{colspan:"3"}},[o("a-input",{staticStyle:{height:"48px",border:"none"},attrs:{placeholder:"请输入拟稿科室"},model:{value:e.form2.drafting_department,callback:function(t){e.$set(e.form2,"drafting_department",t)},expression:"form2.drafting_department"}})],1)]),o("tr",[o("td",{staticClass:"wt120 tc bold red1"},[e._v("拟稿人")]),o("td",{attrs:{colspan:"3"}},[o("a-input",{staticStyle:{height:"48px",border:"none"},attrs:{placeholder:"请输入拟稿人"},model:{value:e.form2.drafter,callback:function(t){e.$set(e.form2,"drafter",t)},expression:"form2.drafter"}})],1)]),o("tr",[o("td",{staticClass:"wt120 tc bold red1"},[e._v("发文时间")]),o("td",{staticStyle:{width:"260px"}},[o("a-date-picker",{staticStyle:{width:"100%",display:"inline-block"},attrs:{valueFormat:"YYYY-MM-DD"},model:{value:e.form2.document_send_time,callback:function(t){e.$set(e.form2,"document_send_time",t)},expression:"form2.document_send_time"}},[e.form2.document_send_time?o("div",{staticClass:"plr5"},[e._v(e._s(e.form2.document_send_time))]):o("div",{staticClass:"plr10 corb8"},[e._v("请选择发文时间")])])],1),o("td",{staticClass:"wt80 tc bold red1"},[o("span",{staticClass:"posRelt star"},[e._v("文号")])]),o("td",[o("div",{staticClass:"flex alcenter"},[o("a-select",{staticStyle:{flex:"1"},attrs:{placeholder:"请选择"},model:{value:e.form2.document_number_prefix,callback:function(t){e.$set(e.form2,"document_number_prefix",t)},expression:"form2.document_number_prefix"}},e._l(e.formData.document_number_prefix,(function(t){return o("a-select-option",{key:t.code,attrs:{value:t.code}},[e._v(" "+e._s(t.value)+" ")])})),1),o("div",{staticClass:"wt60"},[e._v("【"+e._s(e.form2.document_number_year)+"】")]),o("a-input-number",{staticStyle:{flex:"1",height:"48px",border:"none"},attrs:{min:0,placeholder:"文号 (必填)"},model:{value:e.form2.document_number,callback:function(t){e.$set(e.form2,"document_number",t)},expression:"form2.document_number"}})],1)])]),o("tr",[o("td",{staticClass:"wt120 tc bold red1"},[e._v("印刷份数")]),o("td",{attrs:{colspan:"3"}},[o("a-input-number",{staticStyle:{width:"100%",height:"48px",border:"none"},attrs:{min:0,placeholder:"请输入份数"},model:{value:e.form2.printing_number,callback:function(t){e.$set(e.form2,"printing_number",t)},expression:"form2.printing_number"}})],1)])])]):e._e(),o("div",{staticClass:"flex jscenter mt20"},[o("a-button",{attrs:{icon:"delete",type:"danger"},on:{click:e.onClearForm}},[e._v("内容重置新发文")])],1),o("HandleForm",{ref:"HandleForm",on:{ok:e.onClearForm}})],1)],1)},r=[],a=o("c964"),i=(o("96cf"),o("d81d"),o("4de4"),o("caad"),o("2532"),o("d3b7"),o("159b"),o("a15b"),o("2af9")),s=o("126f"),c=o("e5f9"),l=o("1fb4"),d={components:{STable:i["r"],XCard:i["w"],HandleForm:l["default"]},data:function(){return{formData:{document_type:[],haveCirculationRole:[],haveCirculationRoleCode:[],allCirculationRoles:[{id:624000270828037,code:"office_archivist",name:"办公室档案员"},{id:624000511341061,code:"director_of_office",name:"办公室主任"},{id:624001084617221,code:"middle_level",name:"中层"},{id:624000931480069,code:"vice_principal",name:"副校长、工会主席、校长助理"},{id:624000669082117,code:"principal",name:"段校长"}],confidentiality_level:[],time_limit:[],document_number_prefix:[]},circulation_id:null,document_id:null,document_type:"1",form1:{number:0,document_time:"",confidentiality_level:"1",time_limit:"1",document_text_list:[],file_list:[]},form2:{document_title:"",document_send_time:"",document_number_prefix:"1",document_number_year:"",printing_number:1,file_list:[]},saveLoading:!1,handleLoading:!1}},created:function(){this.getRole(),this.dictTypeDropDown()},methods:{getRole:function(){var e=this.formData.allCirculationRoles.map((function(e){return e.code}));this.formData.haveCirculationRole=this.$userInfo.roles.filter((function(t){return e.includes(t.code)})),this.formData.haveCirculationRoleCode=this.formData.haveCirculationRole.map((function(e){return e.code})),this.formData.haveCirculationRoleCode.includes("office_archivist")&&this.formData.haveCirculationRoleCode.includes("middle_level")?(this.formData.document_type=[{code:"1",name:"上级来文"},{code:"2",name:"校内文件"}],this.document_type="1"):this.formData.haveCirculationRoleCode.includes("office_archivist")?(this.formData.document_type=[{code:"1",name:"上级来文"}],this.document_type="1"):this.formData.haveCirculationRoleCode.includes("middle_level")&&(this.formData.document_type=[{code:"2",name:"校内文件"}],this.document_type="2")},dictTypeDropDown:function(){var e=this;Object(s["c"])({code:"confidentiality_level"}).then((function(t){e.formData.confidentiality_level=t.data||[]})),Object(s["c"])({code:"time_limit"}).then((function(t){e.formData.time_limit=t.data||[]})),Object(s["c"])({code:"document_number_prefix"}).then((function(t){e.formData.document_number_prefix=t.data||[]})),this.form2.document_send_time=this.$moment().format("YYYY-MM-DD"),this.form2.document_number_year=this.$moment().format("YYYY")},onchangeFileInSchool:function(e){if(e.length){var t=e[0],o=t&&t.fileOriginName;this.form2.document_title=o.substring(0,o.lastIndexOf("."))}},onClearForm:function(){this.document_id=null,this.circulation_id=null,"1"===this.document_type&&(this.form1=Object.assign({},this.$options.data().form1)),"2"===this.document_type&&(this.form2=Object.assign({},this.$options.data().form2),this.form2.document_send_time=this.$moment().format("YYYY-MM-DD"),this.form2.document_number_year=this.$moment().format("YYYY"))},save:function(){this.saveLoading=!0,this.postData()},handle:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.postData();case 2:if(o=t.sent,o){t.next=5;break}return t.abrupt("return",!1);case 5:e.$refs.HandleForm.edit({id:e.circulation_id,document_id:e.document_id,document_type:e.document_type,step:1,current_step:{current_step:"1"===e.document_type?"office_archivist":"2"===e.document_type?"middle_level":"",current_step_name:"1"===e.document_type?"办公室档案员":"2"===e.document_type?"中层领导":""}});case 6:case"end":return t.stop()}}),t)})))()},postData:function(){var e=this,t=this;return new Promise((function(o){var n="1"===t.document_type?JSON.parse(JSON.stringify(t.form1)):JSON.parse(JSON.stringify(t.form2));if(n.document_type=t.document_type,Array.isArray(n.document_text_list)){var r=[];n.document_text_list.forEach((function(e){r.push(e.id)})),n.document_text=r.join("|")}if(delete n.document_text_list,Array.isArray(n.file_list)){var a=[];n.file_list.forEach((function(e){a.push(e.id)})),n.files=a.join("|")}if(delete n.file_list,!t.check(n,t))return o(!1),!1;t.handleLoading=!0,t.document_id?(n.id=e.document_id,Object(c["c"])(n).then((function(e){e.success?(t.$message.success("更新成功！"),o(!0)):(t.$message.error(JSON.stringify(e.message)),o(!1)),t.saveLoading=!1,t.handleLoading=!1}))):Object(c["a"])(n).then((function(e){e.success?(t.$message.success("保存成功！"),t.document_id=e.data.document_id,t.circulation_id=e.data.circulation_id,o(!0)):(t.$message.error(JSON.stringify(e.message)),o(!1)),t.saveLoading=!1,t.handleLoading=!1}))}))},check:function(e){var t=!0;return"1"===e.document_type?(e.document_unit||(this.$message.error("未填写来文单位"),t=!1),e.received_font_size||(this.$message.error("未填写收文字号"),t=!1),e.document_title||(this.$message.error("未填写来文标题"),t=!1)):"2"===e.document_type&&(e.document_title||(this.$message.error("未填写文件标题"),t=!1),e.document_number||(this.$message.error("未填写文号"),t=!1)),t}}},u=d,m=(o("84e4"),o("0c7c")),f=Object(m["a"])(u,n,r,!1,null,"ebc93128",null);t["default"]=f.exports}}]);