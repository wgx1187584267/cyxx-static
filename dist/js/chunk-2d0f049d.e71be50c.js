(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0f049d"],{"9c74":function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("a-modal",{attrs:{title:e.title,width:600,visible:e.visible},on:{cancel:e.handleCancel,ok:e.handleSubmit}},[r("a-form-model",{ref:"ruleForm",attrs:{model:e.form,"label-col":e.labelCol,"wrapper-col":e.wrapperCol,rules:e.rules}},[r("a-tabs",{model:{value:e.activeKey,callback:function(t){e.activeKey=t},expression:"activeKey"}},[r("a-tab-pane",{key:"1",attrs:{tab:"新增"}},["1"==e.activeKey?r("a-form-model-item",{attrs:{prop:"score"}},[r("template",{slot:"label"},[r("span",[e._v("分值设置")])]),r("a-input-number",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入分值设置",min:0,max:100},model:{value:e.form.score,callback:function(t){e.$set(e.form,"score",t)},expression:"form.score"}})],2):e._e(),"1"==e.activeKey?r("a-form-model-item",{attrs:{label:"是否计入核算",prop:"yes_or_no"}},[r("a-radio-group",{model:{value:e.form.yes_or_no,callback:function(t){e.$set(e.form,"yes_or_no",t)},expression:"form.yes_or_no"}},e._l(e.yesOrNoData,(function(t,o){return r("a-radio",{key:o,attrs:{value:t.code}},[e._v(e._s(t.name))])})),1)],1):e._e(),"1"==e.activeKey?r("a-form-model-item",{attrs:{label:"备注"}},[r("a-textarea",{attrs:{placeholder:"请输入备注",allowClear:!0,"auto-size":{minRows:2}},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1):e._e()],1),e.isEdit?r("a-tab-pane",{key:"2",attrs:{tab:"变更"}},["2"==e.activeKey?r("a-form-model-item",{attrs:{label:"当前分值",prop:"beforeScore"}},[r("a-input-number",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入当前分值",disabled:!0},model:{value:e.form.beforeScore,callback:function(t){e.$set(e.form,"beforeScore",t)},expression:"form.beforeScore"}})],1):e._e(),"2"==e.activeKey?r("a-form-model-item",{attrs:{label:"变更后分值",prop:"afterScore"}},[r("a-input-number",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入变更后分值",min:0,max:100},model:{value:e.form.afterScore,callback:function(t){e.$set(e.form,"afterScore",t)},expression:"form.afterScore"}})],1):e._e(),"2"==e.activeKey?r("a-form-model-item",{attrs:{label:"是否计入核算",prop:"yes_or_no"}},[r("a-radio-group",{model:{value:e.form.yes_or_no,callback:function(t){e.$set(e.form,"yes_or_no",t)},expression:"form.yes_or_no"}},e._l(e.yesOrNoData,(function(t,o){return r("a-radio",{key:o,attrs:{value:t.code}},[e._v(e._s(t.name))])})),1)],1):e._e(),"2"==e.activeKey?r("a-form-model-item",{attrs:{label:"备注"}},[r("a-textarea",{attrs:{placeholder:"请输入备注",allowClear:!0,"auto-size":{minRows:2}},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1):e._e()],1):e._e()],1)],1),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("a-button",{key:"back",on:{click:e.handleCancel}},[e._v(" 取消 ")]),r("a-button",{key:"submit",attrs:{type:"primary",loading:e.loading},on:{click:e.handleSubmit}},[e._v("确定 ")])],1)],1)},a=[],i=(r("a15b"),r("d3b7"),r("25f0"),r("01bd")),s=r("d0fff"),l={data:function(){return{title:"评价",labelCol:{span:6},wrapperCol:{span:14},visible:!1,loading:!1,fieldNames:{label:"name",value:"id",children:"children"},rules:{score:[{required:!0,message:"请输入分值设置",trigger:"blur"}],yes_or_no:[{required:!0,message:"请选择是否计入核算",trigger:"change"}],beforeScore:[{required:!0,message:"请输入当前分值",trigger:"blur"}],afterScore:[{required:!0,message:"请输入变更后分值",trigger:"blur"}]},form:{evaluation_project_id:null},operationType:[],yearTree:[],yesOrNoData:[],gradeId:null,activeKey:"1",isEdit:!1,anchorPoint:""}},methods:{setting:function(e,t,r,o,a,i,s,l,n){this.yesOrNoData=this.$options.filters["dictData"]("yes_or_no"),this.title=a+"评价",this.visible=!0,this.loading=!1,this.form=Object.assign({},this.$options.data().form),"solo"==e?(this.isEdit=!0,this.anchorPoint="itemId"+r,this.$set(this.form,"beforeScore",t),this.$set(this.form,"record_id",n)):"more"==e&&(this.isEdit=!1),this.activeKey="1",this.$set(this.form,"operation_type","1"),this.$set(this.form,"yes_or_no",l),-1!==a.indexOf("演唱表现")&&(this.form.song_id=s),this.gradeId=i,this.form.student_ids=r,this.form.evaluation_project_id=o,this.operationType=this.$options.filters["dictData"]("operation_type"),this.getChangeTypeTree()},getChangeTypeTree:function(){var e=this;Object(s["g"])().then((function(t){e.yearTree=t.data}))},handleSubmit:function(){var e=this;this.loading=!0,this.$refs.ruleForm.validate((function(t){if(!t)return e.loading=!1,!1;var r=JSON.parse(JSON.stringify(e.form));if(r.student_ids?r.student_ids=Array.isArray(r.student_ids)?r.student_ids.join("|"):r.student_ids.toString():delete r.student_ids,"2"==e.activeKey){var o=r.afterScore-r.beforeScore;o>0?(r.operation_type="1",r.score=o):(r.operation_type="2",r.score=-o)}else delete e.form.record_id;Object(i["b"])(r).then((function(t){t.success?(e.visible=!1,e.$message.success("评价成功！"),e.$emit("ok",e.anchorPoint)):(e.loading=!1,e.$message.error("评价失败："+t.message))}))}))},handleCancel:function(){this.visible=!1}}},n=l,c=r("0c7c"),m=Object(c["a"])(n,o,a,!1,null,null,null);t["default"]=m.exports}}]);