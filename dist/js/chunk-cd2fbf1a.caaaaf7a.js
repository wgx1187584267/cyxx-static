(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-cd2fbf1a"],{"56c0":function(e,t,a){},"8fd9":function(e,t,a){"use strict";a("56c0")},b15a:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("x-card",[a("div",{staticClass:"table-page-search-wrapper",attrs:{slot:"content"},slot:"content"},[a("a-form",{attrs:{layout:"inline"}},[a("a-row",{attrs:{gutter:48}},[a("a-col",{attrs:{md:8,sm:24}},[a("a-form-item",{attrs:{label:"学年学期"}},[a("a-cascader",{attrs:{fieldNames:e.fieldNames,options:e.yearTree,placeholder:"请选择学年学期","change-on-select":!1},model:{value:e.queryParam.ysValue,callback:function(t){e.$set(e.queryParam,"ysValue",t)},expression:"queryParam.ysValue"}})],1)],1),a("a-col",{attrs:{md:8,sm:24}},[a("a-form-item",{attrs:{label:"班级"}},[a("ClassSelect",{ref:"ClassSelect",attrs:{placeholder:"请选择年级/班级",changeOnSelect:!0,academicStage:"2",ysValue:e.queryParam.ysValue},model:{value:e.queryParam.classSelData,callback:function(t){e.$set(e.queryParam,"classSelData",t)},expression:"queryParam.classSelData"}})],1)],1),e.advanced?[a("a-col",{attrs:{md:8,sm:24}},[a("a-form-item",{attrs:{label:"考核时间"}},[a("a-range-picker",{staticStyle:{width:"100%"},attrs:{"show-time":!0,placeholder:["开始时间","结束时间"],format:"YYYY-MM-DD HH:mm:ss"},model:{value:e.queryParam.time,callback:function(t){e.$set(e.queryParam,"time",t)},expression:"queryParam.time"}})],1)],1)]:e._e(),a("a-col",{attrs:{md:e.advanced?24:8,sm:24}},[a("span",{staticClass:"table-page-search-submitButtons",style:e.advanced&&{float:"right",overflow:"hidden"}||{}},[a("h-search-button",{on:{click:function(t){return e.$refs.table.refresh(!0)}}}),a("h-reset-button",{staticStyle:{"margin-left":"8px"},on:{click:e.resetQuery}}),a("a",{staticStyle:{"margin-left":"8px"},on:{click:e.toggleAdvanced}},[e._v(" "+e._s(e.advanced?"收起":"展开")+" "),a("a-icon",{attrs:{type:e.advanced?"up":"down"}})],1)],1)])],2)],1)],1)]),a("div",[a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"app-container"},[e.defaultId?a("TagSelect",{attrs:{list:e.itemData,defaultId:e.defaultId},on:{onclose:e.onClickActive}}):e._e()],1),a("s-table",{key:e.tableKey,ref:"table",attrs:{columns:e.columns,data:e.loadData,alert:!1,rowKey:function(e){return e.id},rowSelection:{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange}},scopedSlots:e._u([{key:"grade_name",fn:function(t,n){return a("span",{},[e._v(" "+e._s(e._f("userDictType")("grade_name",n.grade_name))+" ")])}},{key:"action",fn:function(t,n){return a("span",{},[a("h-link",{attrs:{type:"success"},nativeOn:{click:function(t){return e.$refs.detailedForm.show(n,e.chooseTitle,e.childItem)}}},[e._v("详细")])],1)}}])},[a("div",{staticClass:"table-operator",attrs:{slot:"operator"},slot:"operator"},[a("a-space",[a("a-button",{attrs:{icon:"down-circle"},on:{click:e.exportFile}},[e._v("导出")])],1)],1)])],1)],1)],1),a("detailedForm",{ref:"detailedForm"})],1)},l=[],s=a("d0ff"),i=(a("159b"),a("a434"),a("d81d"),a("b0c0"),a("2af9")),c=a("c1df"),r=a.n(c),d=a("d0fff"),o=a("5d1e"),m=a("e42f"),u=a("ad81"),h=a("27c9"),f=a("7862"),g=a("ca00"),y={components:{STable:i["r"],XCard:i["w"],detailedForm:f["default"],TagSelect:h["a"],ClassSelect:u["a"]},data:function(){var e=this;return{selectedRowKeys:[],selectedRows:[],labelCol:{span:6},wrapperCol:{span:16},loading:!1,fieldNames:{label:"name",value:"id",children:"children"},tstyle:{"padding-bottom":"0px","margin-bottom":"10px"},queryParam:{ysValue:[],classSelData:[],time:[]},defaultParam:{ysValue:[],classSelData:[],time:[]},yearTree:[],classTree:[],tableKey:0,itemData:[],childItem:[],defaultId:null,advanced:!1,chooseTitle:"",columns:[{title:"学年",align:"center",dataIndex:"school_year_name"},{title:"学期",align:"center",dataIndex:"semester_name"},{title:"年级",align:"center",dataIndex:"grade_name",scopedSlots:{customRender:"grade_name"}},{title:"班级",align:"center",dataIndex:"class_name"},{title:"班主任",align:"center",dataIndex:"class_teacher_name"},{title:"总分",align:"center",dataIndex:"total_score"},{title:"操作",align:"center",width:"80px",dataIndex:"action",scopedSlots:{customRender:"action"}}],defaultColumns:[{title:"学年",align:"center",dataIndex:"school_year_name"},{title:"学期",align:"center",dataIndex:"semester_name"},{title:"年级",align:"center",dataIndex:"grade_name",scopedSlots:{customRender:"grade_name"}},{title:"班级",align:"center",dataIndex:"class_name"},{title:"班主任",align:"center",dataIndex:"class_teacher_name"},{title:"总分",align:"center",dataIndex:"total_score"},{title:"操作",align:"center",width:"80px",dataIndex:"action",scopedSlots:{customRender:"action"}}],loadData:function(t){if(e.queryParam.type_id)return Object(m["h"])(Object.assign(t,e.switchingDate())).then((function(t){var a=t.data,n=a.rows||[];if(n.forEach((function(e){e.item.forEach((function(t,a){for(var n in t)if(t.hasOwnProperty(n)){var l=n+a;e[l]=t[n]}}))})),n&&n.length>0&&n[0].item&&e.columns.length<9){if("常规考核月统计"==e.chooseTitle){var l={title:"考核时间",align:"center",dataIndex:"year_month_name"};e.columns.splice(6,0,l)}for(var s={},i=0;i<n[0].item.length;i++)s={title:n[0].item[i].project_name,align:"center",dataIndex:"total".concat(i)},e.columns.splice(e.columns.length-2,0,s)}return a}))}}},created:function(){this.getList(),this.getChangeTypeTree()},methods:{moment:r.a,getList:function(){var e=this;this.columns=Object(s["a"])(this.defaultColumns),Object(o["g"])().then((function(t){if(t.success){var a=e.deleteChildren(t.data);e.itemData=a.map((function(e){return"班级常规考核"==e.name?{project_name:"常规考核月统计",id:e.id,children:e.children}:{project_name:e.name+"学期统计",id:e.id,children:e.children}})),e.defaultId=e.itemData[0].id,e.queryParam.type_id=e.defaultId,e.defaultParam.type_id=e.defaultId,e.chooseTitle=e.itemData[0].project_name,e.childItem=e.itemData[0].children,e.tableKey+=1}}))},getChangeTypeTree:function(){var e=this;Object(d["g"])().then((function(t){e.yearTree=e.deleteChildren(t.data)}))},deleteChildren:function(e){for(var t=e,a=t.length;a--;a>0)t[a].children&&(t[a].children.length?this.deleteChildren(t[a].children):delete t[a].children);return e},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t},switchingDate:function(){var e=JSON.parse(JSON.stringify(this.queryParam));return e.ysValue&&e.ysValue.length?e.school_year=e.ysValue[0]:delete e.school_year,e.ysValue&&e.ysValue.length?e.semester=e.ysValue[1]:delete e.semester,delete e.ysValue,e.classSelData&&e.classSelData.length?e.grade_id=e.classSelData[0]:delete e.grade_id,e.classSelData&&e.classSelData.length?e.class_id=e.classSelData[1]:delete e.class_id,delete e.classSelData,e.time&&e.time.length?e.start_time=r()(e.time[0]).format("YYYY-MM-DD HH:mm:ss"):delete e.start_time,e.time&&e.time.length?e.end_time=r()(e.time[1]).format("YYYY-MM-DD HH:mm:ss"):delete e.end_time,delete e.time,e},onClickActive:function(e){this.queryParam.type_id=e.id,this.defaultParam.type_id=e.id,this.chooseTitle=e.project_name,this.childItem=e.children,this.columns=Object(s["a"])(this.defaultColumns),this.tableKey+=1},handleOk:function(){this.columns=Object(s["a"])(this.defaultColumns),this.tableKey+=1},resetQuery:function(){this.queryParam={ysValue:[],classSelData:[],time:[],type_id:this.defaultParam.type_id}},toggleAdvanced:function(){this.advanced=!this.advanced},exportFile:function(){var e=this,t=Object.assign({},this.switchingDate());Object(m["f"])(t).then((function(e){Object(g["b"])(e)})).catch((function(){e.$message.error("下载错误：获取文件流错误")}))}}},p=y,_=(a("8fd9"),a("0c7c")),b=Object(_["a"])(p,n,l,!1,null,"e921ff20",null);t["default"]=b.exports}}]);