(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4473a761","chunk-0f48da4b","chunk-44343f94","chunk-2d0bd5f3","chunk-2d0dd3af"],{"0f64":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-modal",{attrs:{destroyOnClose:!0,title:e.modalTitle,width:900,visible:e.visible,bodyStyle:e.bodyStyle,footer:null},on:{cancel:e.handleCancel}},[n("a-card",{attrs:{bordered:!1}},[1==e.form.question_type||2==e.form.question_type?n("div",{staticStyle:{background:"#f4f4f4",padding:"15px 15px 15px 0","margin-bottom":"15px","border-radius":"10px"}},[n("a-row",{staticStyle:{"margin-bottom":"15px"},attrs:{type:"flex",align:"middle"}},[n("a-col",{staticStyle:{"text-align":"right"},attrs:{span:3}},[e._v("题干：")]),n("a-col",{attrs:{span:15}},[n("div",{staticClass:"myText",domProps:{innerHTML:e._s(e.form.stem)},on:{click:function(t){return e.$refs.editorModal.showModal("stem",e.form.stem)}}})]),n("a-col",{attrs:{span:3}},[n("a-checkbox",{staticStyle:{"margin-left":"10px"},attrs:{checked:!!Number(e.form.must_answer)},on:{change:e.onChangeMustAnswer}},[e._v("必答")])],1)],1),n("div",[e._l(e.form.questionnaire_question_option,(function(t,i){return n("a-row",{key:t.id||t.key,staticStyle:{"margin-bottom":"15px"}},[1==e.form.question_type?n("a-radio-group",{staticStyle:{width:"100%"},model:{value:e.singleAnswer,callback:function(t){e.singleAnswer=t},expression:"singleAnswer"}},[n("a-col",{staticStyle:{"text-align":"right",display:"inline-flex","flex-direction":"row","align-items":"baseline","justify-content":"flex-end","flex-wrap":"nowrap"},attrs:{span:3}},[n("a-radio",{style:e.radioStyle,attrs:{value:t.sort}}),n("div",[e._v("选项"+e._s(String.fromCharCode(Number(i)+65))+"：")])],1),n("a-col",{attrs:{span:13}},[n("span",{staticClass:"myText",domProps:{innerHTML:e._s(t.content)},on:{click:function(n){return n.stopPropagation(),n.preventDefault(),e.$refs.editorModal.showModal("questionnaire_question_option",t.content,i)}}})]),n("a-col",{attrs:{span:5}},[n("div",{staticStyle:{display:"flex","flex-direction":"column","flex-wrap":"nowrap","align-items":"baseline","justify-content":"center"}},[n("a-checkbox",{staticStyle:{margin:"8px 0 0 15px"},attrs:{checked:"1"==t.is_fill},on:{change:function(n){return e.onChangeFill(n,t)}}},[e._v("可否填空")]),n("div",[e._v(" 选项分值： "),n("a-input-number",{staticStyle:{"margin-top":"10px"},attrs:{id:"inputNumber",min:0,placeholder:"选项分值",size:"small"},model:{value:t.score,callback:function(n){e.$set(t,"score",n)},expression:"item.score"}})],1)],1)]),n("a-col",{attrs:{span:3}},[n("a-button",{staticStyle:{margin:"8px 0 0 25px"},attrs:{type:"danger",shape:"circle",icon:"close"},on:{click:function(n){return e.removeOption(t)}}})],1)],1):e._e(),2==e.form.question_type?n("div",{staticStyle:{width:"100%"}},[n("a-col",{staticStyle:{"text-align":"right",display:"inline-flex","flex-direction":"row","align-items":"baseline","justify-content":"flex-end","flex-wrap":"nowrap"},attrs:{span:3}},[n("a-checkbox",{style:e.radioStyle,attrs:{checked:e.multipleAnswer.includes(t.sort),value:t.sort},on:{change:function(n){return e.onChangeAnswer(n,t)}}}),n("div",[e._v("选项"+e._s(String.fromCharCode(Number(i)+65))+"：")])],1),n("a-col",{attrs:{span:13}},[n("span",{staticClass:"myText",domProps:{innerHTML:e._s(t.content)},on:{click:function(n){return n.stopPropagation(),n.preventDefault(),e.$refs.editorModal.showModal("questionnaire_question_option",t.content,i)}}})]),n("a-col",{attrs:{span:5}},[n("div",{staticStyle:{display:"flex","flex-direction":"column","flex-wrap":"nowrap","align-items":"baseline","justify-content":"center"}},[n("a-checkbox",{staticStyle:{margin:"8px 0 0 15px"},attrs:{checked:"1"==t.is_fill},on:{change:function(n){return e.onChangeFill(n,t)}}},[e._v("可否填空")]),n("div",[e._v(" 选项分值： "),n("a-input-number",{staticStyle:{"margin-top":"10px"},attrs:{id:"inputNumber",min:0,placeholder:"选项分值",size:"small"},model:{value:t.score,callback:function(n){e.$set(t,"score",n)},expression:"item.score"}})],1)],1)]),n("a-col",{attrs:{span:3}},[n("a-button",{staticStyle:{margin:"8px 0 0 25px"},attrs:{type:"danger",shape:"circle",icon:"close"},on:{click:function(n){return e.removeOption(t)}}})],1)],1):e._e()],1)})),1==e.form.question_type||2==e.form.question_type||4==e.form.question_type?n("a-button",{staticStyle:{width:"80%","margin-left":"88px"},attrs:{type:"dashed"},on:{click:e.addOption}},[n("a-icon",{attrs:{type:"plus"}}),e._v("添加选项")],1):e._e()],2)],1):e._e(),3==e.form.question_type||4==e.form.question_type||5==e.form.question_type?n("div",[n("p",[e._v(" 请在下方输入题干内容："),n("span",{directives:[{name:"show",rawName:"v-show",value:4==e.form.question_type,expression:"form.question_type == 4"}]},[e._v("（中间需要填空的请点击“插入填空符”按钮）"),n("a-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"primary"},on:{click:e.insertBlankFn}},[e._v("插入填空符")])],1)]),n("j-editor",{attrs:{editorHeight:320},on:{onClick:e.onClickEditor},model:{value:e.form.stem,callback:function(t){e.$set(e.form,"stem",t)},expression:"form.stem"}}),n("a-checkbox",{staticStyle:{"margin-top":"20px"},attrs:{checked:!!Number(e.form.must_answer)},on:{change:e.onChangeMustAnswer}},[e._v("必答")])],1):e._e(),n("div",{staticStyle:{background:"#f4f4f4",padding:"15px 15px 15px 0","margin-bottom":"15px","border-radius":"10px"}},[n("a-row",{staticStyle:{"margin-bottom":"15px"},attrs:{type:"flex",align:"middle"}},[n("a-col",{staticStyle:{"text-align":"right"},attrs:{span:3}},[e._v("问题分值：")]),n("a-col",{attrs:{span:18}},[n("a-input-number",{staticStyle:{width:"100%"},attrs:{id:"inputNumber",min:0},model:{value:e.form.score,callback:function(t){e.$set(e.form,"score",t)},expression:"form.score"}})],1)],1),3==e.form.question_type?n("a-row",{staticStyle:{"margin-bottom":"15px"},attrs:{type:"flex",align:"middle"}},[n("a-col",{staticStyle:{"text-align":"right"},attrs:{span:3}},[e._v("问题答案：")]),n("a-col",{attrs:{span:18}},[n("a-radio-group",{model:{value:e.judgeAnswer,callback:function(t){e.judgeAnswer=t},expression:"judgeAnswer"}},[n("a-radio",{attrs:{value:!0}},[e._v(" 正确 ")]),n("a-radio",{attrs:{value:!1}},[e._v(" 错误 ")])],1)],1)],1):e._e(),4==e.form.question_type?n("a-row",{staticStyle:{"margin-bottom":"15px"},attrs:{type:"flex",align:"middle"}},[n("a-col",{staticStyle:{"text-align":"right"},attrs:{span:3}},[e._v("问题答案：")]),n("a-col",{attrs:{span:18}},e._l(e.form.questionnaire_question_option,(function(t,i){return n("div",{key:t.id||t.key,staticStyle:{display:"flex","flex-direction":"row","flex-wrap":"nowrap","align-items":"center","margin-bottom":"5px"}},[n("span",[e._v(e._s(i+1)+"、")]),n("span",{staticClass:"myText",staticStyle:{"margin-right":"15px",height:"30px"},domProps:{innerHTML:e._s(t.content)},on:{click:function(n){return n.stopPropagation(),n.preventDefault(),e.$refs.editorModal.showModal("questionnaire_question_option",t.content,i)}}})])})),0)],1):e._e(),5==e.form.question_type?n("a-row",{staticStyle:{"margin-bottom":"15px"},attrs:{type:"flex",align:"middle"}},[n("a-col",{staticStyle:{"text-align":"right"},attrs:{span:3}},[e._v("问题答案：")]),n("a-col",{attrs:{span:18}},[n("div",{staticClass:"myText",domProps:{innerHTML:e._s(e.form.question_answer)},on:{click:function(t){return e.$refs.editorModal.showModal("question_answer",e.form.question_answer)}}})])],1):e._e(),n("a-row",{staticStyle:{"margin-bottom":"15px"},attrs:{type:"flex",align:"middle"}},[n("a-col",{staticStyle:{"text-align":"right"},attrs:{span:3}},[e._v("问题解析：")]),n("a-col",{attrs:{span:18}},[n("div",{staticClass:"myText",domProps:{innerHTML:e._s(e.form.analysis)},on:{click:function(t){return e.$refs.editorModal.showModal("analysis",e.form.analysis)}}})])],1)],1),n("div",{staticClass:"btn"},[n("a-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("保存")]),n("a-button",{staticStyle:{"margin-left":"20px"},on:{click:e.handleCancel}},[e._v("关闭")])],1),n("EditorModal",{ref:"editorModal",on:{ok:e.handleOK}})],1)],1)},s=[],o=(n("a9e3"),n("d81d"),n("ac1f"),n("1276"),n("fb6a"),n("a15b"),n("5319"),n("466d"),n("a434"),n("159b"),n("4de4"),n("a630"),n("3ca3"),n("d3b7"),n("6062"),n("ddb0"),n("e562")),a=n.n(o),r=n("0b996"),l=n("8100"),c={name:"SubjectAddEditModal",components:{EditorModal:l["default"],JEditor:r["a"]},data:function(){return{visible:!1,bodyStyle:{padding:"0"},modalWidth:800,radioStyle:{display:"block",height:"40px",lineHeight:"40px",marginBottom:"30px"},editorID:null,form:{question_type:1,stem:"",must_answer:0,questionnaire_question_option:[{key:Date.now(),content:"",sort:1,is_fill:"0"}],score:0,question_answer:"",analysis:""},blockIndex:null,multipleAnswer:[],singleAnswer:0,judgeAnswer:!0,blanksAnswer:[{id:1}],score_correspondence:"",set_answer:"",blank_count:""}},computed:{modalTitle:function(){return 1===this.form.question_type?"单选题":2===this.form.question_type?"多选题":3===this.form.question_type?"判断题":4===this.form.question_type?"填空题":5===this.form.question_type?"问答题":"题目"}},created:function(){},methods:{add:function(e,t,n,i){this.score_correspondence=n,this.set_answer=i,this.blockIndex=t,this.form=Object.assign({},this.$options.data().form),this.form.question_type=e,this.multipleAnswer=[],this.singleAnswer=0,this.judgeAnswer=!0,this.blanksAnswer=[{id:1}],this.visible=!0},edit:function(e,t,n,i){this.score_correspondence=n,this.set_answer=i,this.blockIndex=t;var s=JSON.parse(JSON.stringify(e));this.form=s,1===s.question_type?this.singleAnswer=Number(s.question_answer):2===s.question_type?this.multipleAnswer=s.question_answer.split("|").map(Number):3===s.question_type?(this.judgeAnswer=JSON.parse(s.question_answer),this.form.questionnaire_question_option=[]):4===s.question_type||5===s.question_type&&(this.form.questionnaire_question_option=[]),this.visible=!0},handleSubmit:function(){var e=JSON.parse(JSON.stringify(this.form));if(1===e.question_type)e.question_answer=this.singleAnswer+"";else if(2===e.question_type){var t=this.multipleAnswer.slice().sort((function(e,t){return e-t}));e.question_answer=t.join("|")}else 3===e.question_type?(e.question_answer=this.judgeAnswer+"",e.questionnaire_question_option=[]):4===e.question_type?e.question_answer=e.questionnaire_question_option.map((function(e){return e.content.replace(/<[^>]+>/g,"")})).join("|"):5===e.question_type&&(e.question_answer=e.question_answer.replace(/<[^>]+>/g,""),e.questionnaire_question_option=[]);if("1"==this.set_answer){if("0"==e.question_answer||!e.question_answer)return this.$message.error("未设置问题答案"),!1;if(2===e.question_type&&this.multipleAnswer.length<2)return this.$message.error("请选择多个选项"),!1}if("1"==this.score_correspondence){if(1===e.question_type||2===e.question_type){var n=e.questionnaire_question_option.every((function(e){return e.hasOwnProperty("score")&&Number(e.score)>=0}));if(0==n)return this.$message.error("未设置选项分值"),!1}if(Number(e.score)<=0)return this.$message.error("未设置问题分值"),!1}this.$emit("ok",e,this.blockIndex),this.visible=!1},handleCancel:function(){this.visible=!1},calculateBlanks:function(e){return(e.match(/_+/g)||[]).length},removeOption:function(e){var t=this,n=this.form.questionnaire_question_option.indexOf(e);-1!==n&&(this.form.questionnaire_question_option.splice(n,1),this.form.questionnaire_question_option.forEach((function(e,t){e.sort=t+1})),2===this.form.question_type&&(this.multipleAnswer=this.multipleAnswer.filter((function(e){if(e<=t.form.questionnaire_question_option.length)return e}))))},addOption:function(){this.form.questionnaire_question_option.push({key:Date.now(),content:"",is_fill:"0",sort:this.form.questionnaire_question_option.length+1})},handleOK:function(e){"undefined"===typeof e.index?this.form[e.key]=e.val:this.form[e.key][e.index]["content"]=e.val},onChangeMustAnswer:function(e){this.form.must_answer=e.target.checked?1:0},onChangeFill:function(e,t){1==e.target.checked?t.is_fill="1":0==e.target.checked&&(t.is_fill="0")},onChangeAnswer:function(e,t){if(t.checked=e.target.checked,1==t.checked){var n=this.multipleAnswer;n.push(t.sort),this.multipleAnswer=Array.from(new Set(n))}else{var i=this.multipleAnswer.indexOf(t.sort);i>-1&&(this.multipleAnswer=this.multipleAnswer.filter((function(e){if(t.sort!==e)return e})))}},onClickEditor:function(e,t){this.editorID=t},insertBlankFn:function(){a.a.editors[this.editorID].insertContent("_");var e=this.calculateBlanks(this.form.stem);this.blank_count=Number(e)+1,this.form.questionnaire_question_option=[];for(var t=0;t<this.blank_count;t++)this.form.questionnaire_question_option.push({id:t+1,content:"",sort:t+1,is_fill:0})}}},u=c,d=(n("ac81"),n("0c7c")),p=Object(d["a"])(u,i,s,!1,null,"883027b0",null);t["default"]=p.exports},"15b6":function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"c",(function(){return o})),n.d(t,"f",(function(){return a})),n.d(t,"e",(function(){return r})),n.d(t,"b",(function(){return l})),n.d(t,"h",(function(){return c})),n.d(t,"d",(function(){return u})),n.d(t,"i",(function(){return d})),n.d(t,"g",(function(){return p}));var i=n("b775");function s(e){return Object(i["b"])({url:"/psychologicalQuestionnaire/questionnaireAdd",method:"post",data:e})}function o(e){return Object(i["b"])({url:"/psychologicalQuestionnaire/questionnaireEdit",method:"post",data:e})}function a(e){return Object(i["b"])({url:"/psychologicalQuestionnaire/questionnairePage",method:"post",data:e})}function r(e){return Object(i["b"])({url:"/psychologicalQuestionnaire/questionnaireList",method:"post",data:e})}function l(e){return Object(i["b"])({url:"/psychologicalQuestionnaire/questionnaireDelete",method:"post",data:e})}function c(e){return Object(i["b"])({url:"/psychologicalQuestionnaire/questionnaireState",method:"post",data:e})}function u(e){return Object(i["b"])({url:"/psychologicalQuestionnaire/questionnaireGet",method:"post",data:e})}function d(e){return Object(i["b"])({url:"/psychologicalQuestionnaire/questionnaireSubmit",method:"post",data:e})}function p(e){return Object(i["b"])({url:"/psychologicalQuestionnaire/questionnaireResultPage",method:"post",data:e})}},"2c34":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("a-modal",{attrs:{title:"从题库添加",width:900},on:{ok:e.handleOk},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("a-row",{attrs:{gutter:20}},[n("a-col",{attrs:{span:9}},[n("a-input-search",{staticStyle:{"margin-bottom":"20px"},attrs:{placeholder:"输入问卷名称"},on:{search:e.onSearchQuestionnaire}}),n("a-menu",{attrs:{mode:"vertical"},on:{click:e.handleMenuClick},model:{value:e.defaultSelectedKeys,callback:function(t){e.defaultSelectedKeys=t},expression:"defaultSelectedKeys"}},e._l(e.list,(function(t){return n("a-menu-item",{key:t.id},[n("a-icon",{attrs:{type:"mail"}}),e._v(e._s(t.questionnaire_title))],1)})),1)],1),n("a-col",{attrs:{span:15}},[n("p",[e._v("请选择题块和题目")]),n("a-tree",{attrs:{"tree-data":e.treeData,checkable:"","checked-keys":e.checkedKeys,"expanded-keys":e.expandedKeys,"auto-expand-parent":e.autoExpandParent},on:{check:e.onCheck,expand:e.onExpand},scopedSlots:e._u([{key:"block",fn:function(t){return["root"==t.key?n("div",{staticClass:"root-item"},[e._v(" 全选 ")]):t.isLeaf?n("div",{staticClass:"question-item"},[n("div",{staticClass:"question-header"},[n("div",{class:t.data.must_answer?"starr":"",staticStyle:{width:"10%"}},[e._v(" "+e._s(e.getQuestionIndex(t.blcokId,t.key))+"、 ")]),n("div",{staticStyle:{width:"90%"}},[n("span",{domProps:{innerHTML:e._s(t.data.stem)}})])]),1==t.data.question_type||2==t.data.question_type?n("div",{staticClass:"question-options"},e._l(t.data.questionnaire_question_option,(function(i){return n("div",{key:i.id||i.sort,staticClass:"question-option"},[n("span",{class:1==t.data.question_type?t.data.question_answer==i.sort?"selCircular":"circular":t.data.question_answer.split("|").map(Number).includes(i.sort)?"selSquare":"square"}),n("span",{domProps:{innerHTML:e._s(i.content)}}),"1"==i.is_fill?n("span",[e._v("___")]):e._e()])})),0):e._e(),3==t.data.question_type?n("div",{staticClass:"question-judge-options"},[n("p",[n("span",{class:"true"==t.data.question_answer?"selCircular":"circular"}),e._v(" 正确 ")]),n("p",[n("span",{class:"false"==t.data.question_answer?"selCircular":"circular"}),e._v(" 错误 ")])]):e._e(),5==t.data.question_type?n("div",{staticClass:"question-essay-box"},[n("div",{staticClass:"rectangle"})]):e._e(),n("div",{staticClass:"question-meta"},[n("div",[e._v("问题分值："+e._s(t.data.score)+" 分")]),3===t.data.question_type?n("div",[e._v("问题答案："+e._s("false"==t.data.question_answer?"错误":"true"==t.data.question_answer?"正确":"")+" ")]):e._e(),4===t.data.question_type?n("div",{staticStyle:{display:"flex","flex-direction":"row","flex-wrap":"nowrap","justify-content":"flex-start","align-items":"flex-start"}},[n("div",{staticStyle:{width:"60px"}},[e._v("问题答案：")]),n("div",e._l(t.data.questionnaire_question_option,(function(t){return n("div",{key:t.id||t.key},[n("span",{staticClass:"answerContent",domProps:{innerHTML:e._s(t.content)}})])})),0)]):e._e(),5===t.data.question_type?n("div",{staticStyle:{display:"flex"}},[n("div",{staticStyle:{width:"60px"}},[e._v("问题答案：")]),n("span",{staticClass:"answerContent",domProps:{innerHTML:e._s(t.data.question_answer)}})]):e._e(),n("div",{staticStyle:{display:"inline-flex"}},[n("div",{staticStyle:{width:"60px"}},[e._v("问题解析：")]),n("span",{domProps:{innerHTML:e._s(t.data.analysis)}})])])]):n("div",{staticClass:"subject-item"},[e._v(" "+e._s(t.title)+" ")])]}}])})],1)],1)],1)],1)},s=[],o=n("d0ff"),a=n("54f8"),r=n("f3f3"),l=(n("159b"),n("4de4"),n("caad"),n("2532"),n("d3b7"),n("25f0"),n("7db0"),n("d81d"),n("2ca0"),n("ac1f"),n("5319"),n("99af"),n("c740"),n("13d5"),n("15b6")),c={data:function(){return{visible:!1,list:[],defaultSelectedKeys:[],treeData:[],checkedKeys:[],expandedKeys:[],autoExpandParent:!0,checkAll:!1,selectedQuestions:{},selectQuestionnaireQuestion:[]}},created:function(){},methods:{showModal:function(){this.getQuestionnaireList(),this.visible=!0,this.resetState()},resetState:function(){this.checkedKeys=[],this.expandedKeys=[],this.selectedQuestions={},this.checkAll=!1},handleOk:function(){var e=this,t=this.defaultSelectedKeys[0],n=[];if(!t||!this.selectedQuestions[t])return this.$emit("ok",[]),void(this.visible=!1);this.selectQuestionnaireQuestion.forEach((function(i){var s=e.selectedQuestions[t],o=i.questionnaire_question.filter((function(e){return s.includes(e.id.toString())}));o.length>0&&n.push(Object(r["a"])(Object(r["a"])({},i),{},{questionnaire_question:o}))})),this.$emit("ok",n),this.visible=!1},handleMenuClick:function(e){var t=e.key;this.defaultSelectedKeys=[t],this.resetState();var n=this.list.find((function(e){return e.id==t}));n&&(this.selectQuestionnaireQuestion=n.question_block||[]),this.generateTreeData(t)},onCheck:function(e,t){this.checkedKeys=e;var n=this.defaultSelectedKeys[0];this.selectedQuestions[n]=e.filter((function(e){return e.startsWith("question_")})).map((function(e){return e.replace("question_","")})),this.updateCheckAllStatus()},onExpand:function(e){this.expandedKeys=e},onSearchQuestionnaire:function(e){this.getQuestionnaireList(e)},getQuestionnaireList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Object(l["e"])({questionnaire_title:t}).then((function(t){var n,i;t.success&&(e.list=t.data,e.defaultSelectedKeys=[(null===(n=e.list[0])||void 0===n?void 0:n.id)||0],e.selectQuestionnaireQuestion=(null===(i=e.list[0])||void 0===i?void 0:i.question_block)||[],e.generateTreeData(e.defaultSelectedKeys[0]))}))},generateTreeData:function(e){var t=this,n=this.list.find((function(t){return t.id==e}));if(n&&n.question_block){var i={title:"全选",key:"root",isLeaf:!1,scopedSlots:{title:"block"},children:n.question_block.map((function(e){return{title:e.question_block_name,key:"subject_".concat(e.id),isLeaf:!1,scopedSlots:{title:"block"},children:e.questionnaire_question.map((function(n){return{title:"".concat(n.must_answer?"*":"").concat(t.getQuestionIndexInSubject(e.id,n.id),"、").concat(n.stem),key:"question_".concat(n.id),isLeaf:!0,scopedSlots:{title:"block"},blcokId:e.id,data:n}}))}}))};this.treeData=[i],this.expandedKeys=["root"],n.question_block.length>0&&this.expandedKeys.push("subject_".concat(n.question_block[0].id))}else this.treeData=[]},getQuestionIndexInSubject:function(e,t){var n=this.selectQuestionnaireQuestion.find((function(t){return t.id==e}));if(!n||!n.questionnaire_question)return"";var i=n.questionnaire_question.findIndex((function(e){return e.id==t}));return i>=0?i+1:""},getQuestionIndex:function(e,t){var n=t.replace("question_","");return this.getQuestionIndexInSubject(e,n)},findQuestionById:function(e){var t,n=Object(a["a"])(this.selectQuestionnaireQuestion);try{for(n.s();!(t=n.n()).done;){var i=t.value,s=i.questionnaire_question.find((function(t){return t.id==parseInt(e)}));if(s)return s}}catch(o){n.e(o)}finally{n.f()}return null},updateCheckAllStatus:function(){var e,t=this.defaultSelectedKeys[0],n=this.selectQuestionnaireQuestion.reduce((function(e,t){return[].concat(Object(o["a"])(e),Object(o["a"])(t.questionnaire_question.map((function(e){return e.id}))))}),[]);this.checkAll=n.length>0&&(null===(e=this.selectedQuestions[t])||void 0===e?void 0:e.length)==n.length}}},u=c,d=(n("b291"),n("d73d"),n("0c7c")),p=Object(d["a"])(u,i,s,!1,null,"8b4b2e68",null);t["default"]=p.exports},"2c5a":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-modal",{attrs:{title:e.modalTitle,visible:e.visible},on:{cancel:e.handleCancel,ok:e.handleOk}},[n("a-form-model",{ref:"blockForm",attrs:{layout:"horizontal",model:e.blockData,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[n("a-form-model-item",{attrs:{label:"题块名称",prop:"question_block_name"}},[n("a-input",{attrs:{placeholder:"请输入题块名称"},model:{value:e.blockData.question_block_name,callback:function(t){e.$set(e.blockData,"question_block_name",t)},expression:"blockData.question_block_name"}})],1)],1)],1)},s=[],o=n("f3f3"),a={data:function(){return{visible:!1,modalTitle:"添加题块",labelCol:{span:6},wrapperCol:{span:14},blockData:{question_block_name:"",questions:[]},rules:{question_block_name:[{required:!0,message:"请输入题块名称",trigger:"blur"}]}}},methods:{add:function(){this.modalTitle="添加题块",this.blockData={question_block_name:"",questionnaire_question:[]},this.visible=!0},edit:function(e){this.modalTitle="编辑题块",this.blockData=Object(o["a"])({},e),this.visible=!0},handleCancel:function(){this.visible=!1},handleOk:function(){var e=this;this.$refs.blockForm.validate((function(t){t&&(e.$emit("ok",e.blockData),e.visible=!1)}))}}},r=a,l=n("0c7c"),c=Object(l["a"])(r,i,s,!1,null,null,null);t["default"]=c.exports},3021:function(e,t,n){},8100:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("a-modal",{attrs:{title:"编辑内容",width:e.modalWidth,destroyOnClose:!0},on:{ok:e.handleOk,cancel:e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("j-editor",{attrs:{editorHeight:e.editorHeight},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],1)],1)},s=[],o=n("0b996"),a={components:{JEditor:o["a"]},data:function(){return{isShow:!1,visible:!1,editorHeight:500,modalWidth:900,content:"",key:"",index:""}},created:function(){},methods:{showModal:function(e,t,n){this.isShow=!0,this.visible=!0,this.content=t,this.key=e,this.index=n},handleOk:function(e){this.isShow=!1,this.visible=!1,this.$emit("ok",{key:this.key,val:this.content,index:this.index})},handleCancel:function(){this.isShow=!1,this.visible=!1}}},r=a,l=n("0c7c"),c=Object(l["a"])(r,i,s,!1,null,null,null);t["default"]=c.exports},"8c77":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("a-drawer",{attrs:{title:e.title,placement:"right",width:e.modalWidth,visible:e.visible,bodyStyle:{background:"#F5F5F5"}},on:{close:e.onClose}},[n("a-card",{attrs:{bordered:!1}},[n("a-form-model",{ref:"ruleForm",attrs:{rules:e.rules,model:e.form,"label-col":e.labelCol,"wrapper-col":e.wrapperCol},on:{submit:e.handleSubmit},nativeOn:{submit:function(e){e.preventDefault()}}},[n("a-row",[n("a-col",{attrs:{md:12,sm:24}},[n("a-form-model-item",{attrs:{label:"学年学期",prop:"ysValue"}},[n("a-cascader",{attrs:{fieldNames:e.fieldNames,options:e.yearTree,placeholder:"请选择学年学期（必选）","change-on-select":!0},model:{value:e.form.ysValue,callback:function(t){e.$set(e.form,"ysValue",t)},expression:"form.ysValue"}})],1)],1),n("a-col",{attrs:{md:12,sm:24}},[n("a-form-model-item",{attrs:{label:"适应年级",prop:"grade"}},[n("SelGrade",{attrs:{parameter:{academic_stage:"2"},mode:"multiple",placeholder:"请选择适应年级"},model:{value:e.form.grade,callback:function(t){e.$set(e.form,"grade",t)},expression:"form.grade"}})],1)],1),n("a-col",{attrs:{md:12,sm:24}},[n("a-form-model-item",{attrs:{label:"问卷类型",prop:"questionnaire_type"}},[n("a-select",{attrs:{"allow-clear":"",placeholder:"请选择问卷类型"},model:{value:e.form.questionnaire_type,callback:function(t){e.$set(e.form,"questionnaire_type",t)},expression:"form.questionnaire_type"}},e._l(e.queryContent.questionnaire_type,(function(t){return n("a-select-option",{key:t.code,attrs:{value:t.code}},[e._v(" "+e._s(t.value)+" ")])})),1)],1)],1),n("a-col",{attrs:{md:12,sm:24}},[n("a-form-model-item",{attrs:{label:"问卷名称",prop:"questionnaire_title"}},[n("a-input",{attrs:{placeholder:"填写问卷名称（必填）"},model:{value:e.form.questionnaire_title,callback:function(t){e.$set(e.form,"questionnaire_title",t)},expression:"form.questionnaire_title"}})],1)],1),n("a-col",{attrs:{md:12,sm:24}},[n("a-form-model-item",{attrs:{label:"是否设置答案",prop:"set_answer"}},[n("a-select",{attrs:{placeholder:"请选择是否设置答案"},model:{value:e.form.set_answer,callback:function(t){e.$set(e.form,"set_answer",t)},expression:"form.set_answer"}},e._l(e.queryContent.yes_no_set,(function(t){return n("a-select-option",{key:t.code,attrs:{value:t.code}},[e._v(" "+e._s(t.value)+" ")])})),1)],1)],1),n("a-col",{attrs:{md:12,sm:24}},[n("a-form-model-item",{attrs:{label:"是否设置分值",prop:"score_correspondence"}},[n("a-select",{attrs:{placeholder:"请选择是否设置分值"},model:{value:e.form.score_correspondence,callback:function(t){e.$set(e.form,"score_correspondence",t)},expression:"form.score_correspondence"}},e._l(e.queryContent.yes_no_set,(function(t){return n("a-select-option",{key:t.code,attrs:{value:t.code}},[e._v(" "+e._s(t.value)+" ")])})),1)],1)],1),n("a-col",{attrs:{md:24,sm:24}},[n("a-form-model-item",{attrs:{label:"问卷说明",prop:"questionnaire_describe","label-col":e.labelColDe,"wrapper-col":e.wrapperColDe}},[n("a-input",{attrs:{placeholder:"填写问卷说明（选填）"},model:{value:e.form.questionnaire_describe,callback:function(t){e.$set(e.form,"questionnaire_describe",t)},expression:"form.questionnaire_describe"}})],1)],1)],1),n("div",{staticClass:"form-actions"},[n("a-button",{attrs:{type:"primary","html-type":"submit"}},[e._v("保存问卷")]),n("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.$refs.questionBankForm.showModal()}}},[e._v("批量选题")])],1)],1),n("div",{staticClass:"block-manager"},[e._l(e.form.question_block,(function(t,i){return n("div",{key:t.id,staticClass:"block-item"},[n("a-card",[n("div",{staticClass:"block-header"},[n("h3",[e._v(e._s(t.question_block_name))]),n("div",{staticClass:"block-actions"},[t.questionnaire_question.length>0?n("div",[e._v(" 每题 "),n("a-input-number",{attrs:{step:.1,size:"small"},on:{change:function(n){return e.onChangeScore(n,t,i)}},model:{value:t.questionScore,callback:function(n){e.$set(t,"questionScore",n)},expression:"block.questionScore"}}),e._v(" 分 ")],1):e._e(),n("a-button",{attrs:{type:"primary",icon:"edit",size:"small"},on:{click:function(n){return e.handleEditBlock(t,i)}}}),n("a-button",{attrs:{type:"danger",icon:"delete",size:"small"},on:{click:function(t){return e.handleDeleteBlock(i)}}})],1)]),n("div",{staticClass:"block-questions"},[e._l(t.questionnaire_question,(function(s,o){return n("div",{key:s.id||s.key,staticClass:"question-item"},[n("span",{staticClass:"content"},[1===s.question_type||2===s.question_type?n("div",[n("a-row",[n("a-col",{attrs:{span:20}},[n("h3",[n("span",{class:Number(s.must_answer)?"star":""},[e._v(e._s(t.questionnaire_question.indexOf(s)+1)+"、")]),n("span",{domProps:{innerHTML:e._s(s.stem)}})])]),-1!==s.id?n("a-col",{attrs:{span:4}},[n("a-button",{staticStyle:{float:"right"},attrs:{type:"danger",shape:"circle",icon:"close",size:"small",ghost:""},on:{click:function(t){return e.handleDeleteQuestion(i,o)}}}),n("a-button",{staticStyle:{float:"right"},attrs:{type:"primary",icon:"edit",ghost:"",size:"small"},on:{click:function(t){return e.handleEditQuestion(i,o)}}})],1):e._e()],1),e._l(s.questionnaire_question_option,(function(t){return n("div",{key:t.id||t.key,staticClass:"question-option"},[1===s.question_type?n("span",{class:s.question_answer==t.sort?"selCircular":"circular"}):e._e(),2===s.question_type?n("span",{class:s.question_answer.split("|").map(Number).includes(t.sort)?"selSquare":"square"}):e._e(),n("span",{domProps:{innerHTML:e._s(t.content)}}),"1"==t.is_fill?n("span",[e._v("___")]):e._e()])})),n("a-divider",{attrs:{dashed:""}}),n("div",[n("div",{staticStyle:{"margin-bottom":"8px"}},[e._v(" 问题分值："),n("a-input-number",{staticStyle:{width:"70px"},attrs:{step:.1},model:{value:s.score,callback:function(t){e.$set(s,"score",t)},expression:"question.score"}})],1),n("div",[e._v("问题解析："),n("span",{domProps:{innerHTML:e._s(s.analysis)}})])])],2):n("div",[n("a-row",[n("a-col",{attrs:{span:20}},[n("h3",[n("span",{class:Number(s.must_answer)?"star":""},[e._v(e._s(t.questionnaire_question.indexOf(s)+1)+"、")]),n("span",{domProps:{innerHTML:e._s(s.stem)}})])]),n("a-col",{attrs:{span:4}},[n("a-button",{staticStyle:{float:"right"},attrs:{type:"danger",shape:"circle",icon:"close",size:"small",ghost:""},on:{click:function(t){return e.handleDeleteQuestion(i,o)}}}),n("a-button",{staticStyle:{float:"right"},attrs:{type:"primary",icon:"edit",ghost:"",size:"small"},on:{click:function(t){return e.handleEditQuestion(i,o)}}})],1)],1),3===s.question_type?n("div",{staticClass:"judge-options"},[n("p",[n("span",{class:"true"==s.question_answer?"selCircular":"circular"}),e._v(" 正确 ")]),n("p",[n("span",{class:"false"==s.question_answer?"selCircular":"circular"}),e._v(" 错误 ")])]):e._e(),4===s.question_type?n("div",{staticClass:"fill-blank"},[e._v(" "+e._s(s.blank_count)+" 个填空 ")]):e._e(),5===s.question_type?n("div",{staticClass:"essay-box"},[n("div",{staticClass:"rectangle"})]):e._e(),n("a-divider",{attrs:{dashed:""}}),n("div",[n("div",{staticStyle:{"margin-bottom":"8px"}},[e._v(" 问题分值："),n("a-input-number",{staticStyle:{width:"70px"},attrs:{step:.1},model:{value:s.score,callback:function(t){e.$set(s,"score",t)},expression:"question.score"}})],1),4===s.question_type?n("div",{staticStyle:{"margin-bottom":"8px",display:"flex","flex-direction":"row","flex-wrap":"nowrap","justify-content":"flex-start","align-items":"flex-start"}},[n("div",[e._v("问题答案：")]),n("div",e._l(s.questionnaire_question_option,(function(t){return n("div",{key:t.id||t.key},[n("span",{domProps:{innerHTML:e._s(t.content)}})])})),0)]):e._e(),5===s.question_type?n("div",{staticStyle:{"margin-bottom":"8px"}},[n("div",[e._v("问题答案："),n("span",{domProps:{innerHTML:e._s(s.question_answer)}})])]):e._e(),n("div",[e._v("问题解析："),n("span",{domProps:{innerHTML:e._s(s.analysis)}})])])],1)])])})),n("div",{staticClass:"add-question-btn"},[n("a-card",{staticClass:"add-question-card"},[n("div",{staticClass:"question-type-buttons"},[n("a-button",{attrs:{type:"primary",ghost:""},on:{click:function(t){return e.handleAddQuestion(i,1)}}},[e._v("单选题")]),n("a-button",{attrs:{type:"primary",ghost:""},on:{click:function(t){return e.handleAddQuestion(i,2)}}},[e._v("多选题")]),n("a-button",{attrs:{type:"primary",ghost:""},on:{click:function(t){return e.handleAddQuestion(i,3)}}},[e._v("判断题")]),n("a-button",{attrs:{type:"primary",ghost:""},on:{click:function(t){return e.handleAddQuestion(i,4)}}},[e._v("填空题")]),n("a-button",{attrs:{type:"primary",ghost:""},on:{click:function(t){return e.handleAddQuestion(i,5)}}},[e._v("问答题")])],1)])],1)],2)])],1)})),n("div",{staticClass:"add-block-btn",on:{click:e.handleAddBlock}},[n("a-card",[n("div",{staticStyle:{display:"flex","align-items":"center","flex-direction":"column","justify-content":"center"}},[n("a-button",{attrs:{type:"primary",shape:"circle",size:"large",icon:"plus"}}),n("p",{staticStyle:{"margin-top":"10px"}},[e._v("创建题块")])],1)])],1)],2),n("CreateBlockForm",{ref:"createBlockForm",on:{ok:e.handleBlockOk}}),n("CreateSubjectForm",{ref:"createSubjectForm",on:{ok:e.handleQuestionOk}}),n("QuestionBankForm",{ref:"questionBankForm",on:{ok:e.handleMultipleOk}})],1)],1)],1)},s=[],o=n("f3f3"),a=(n("d81d"),n("a15b"),n("99af"),n("159b"),n("a434"),n("caad"),n("ac1f"),n("466d"),n("2f62")),r=n("2c5a"),l=n("0f64"),c=n("2c34"),u=n("15b6"),d=n("d0fff"),p=n("126f"),f={components:{CreateBlockForm:r["default"],CreateSubjectForm:l["default"],QuestionBankForm:c["default"]},data:function(){return{title:"添加问卷",visible:!1,modalWidth:800,labelCol:{span:8},wrapperCol:{span:14},labelColDe:{span:4},wrapperColDe:{span:19},isShowQuestionBtn:!0,queryContent:{questionnaire_type:[],yes_no_set:[]},form:{ysValue:[],grade:[],questionnaire_title:"",questionnaire_describe:"",set_answer:"0",score_correspondence:"0",question_block:[]},editBlockIndex:null,editQuestionIndex:null,fieldNames:{label:"name",value:"id",children:"children"},yearTree:[],rules:{ysValue:[{required:!0,message:"请选择学年学期",trigger:"change"}],questionnaire_title:[{required:!0,message:"请输入问卷名称",trigger:"blur"}],grade:[{required:!0,message:"请选择适应年级",trigger:"change"}],questionnaire_type:[{required:!0,message:"请选择问卷类型",trigger:"change"}],set_answer:[{required:!0,message:"请选择是否设置答案",trigger:"change"}],score_correspondence:[{required:!0,message:"请选择是否设置分值",trigger:"change"}]}}},computed:Object(o["a"])({},Object(a["c"])(["userInfo"])),created:function(){this.getYearSemesterTree(),this.dictTypeDropDown()},methods:{add:function(){this.title="创建问卷",this.resetForm(),this.visible=!0},edit:function(e){this.title="修改问卷",this.form=JSON.parse(JSON.stringify(e));var t=[this.form.school_year,this.form.semester];this.$set(this.form,"ysValue",t),this.visible=!0},dictTypeDropDown:function(){var e=this;Object(p["c"])({code:"questionnaire_type"}).then((function(t){e.queryContent.questionnaire_type=t.data})),Object(p["c"])({code:"yes_no_set"}).then((function(t){e.queryContent.yes_no_set=t.data}))},getYearSemesterTree:function(){var e=this;Object(d["g"])().then((function(t){e.yearTree=e.filterTree(t.data)}))},filterTree:function(e){var t=this;return e.map((function(e){return Object(o["a"])(Object(o["a"])({},e),{},{children:e.children?t.filterTree(e.children):[]})}))},handleSubmit:function(){var e=this;this.form.add_person_id=this.userInfo.id,this.$refs.ruleForm.validate((function(t){if(t){var n=JSON.parse(JSON.stringify(e.form));n.grade?n.grade=Array.isArray(n.grade)?n.grade.join("|"):n.grade:delete n.grade;var i=e.transformData(n);"创建问卷"===e.title?Object(u["a"])(i).then((function(t){e.handleSubmitCallback(t,"创建")})):Object(u["c"])(i).then((function(t){e.handleSubmitCallback(t,"修改")}))}}))},handleSubmitCallback:function(e,t){e.success?(this.visible=!1,this.$message.success("".concat(t,"问卷成功！")),this.$emit("ok")):this.$message.error("".concat(t,"失败：").concat(e.message))},transformData:function(e){var t=JSON.parse(JSON.stringify(e));return t.ysValue&&t.ysValue.length&&(t.school_year=t.ysValue[0],t.semester=t.ysValue[1],delete t.ysValue),t.question_block.forEach((function(e,t){delete e.id,e.sort=t+1})),t},handleAddBlock:function(){this.$refs.createBlockForm.add()},handleEditBlock:function(e,t){this.editBlockIndex=t,this.$refs.createBlockForm.edit(e)},handleDeleteBlock:function(e){this.form.question_block.splice(e,1)},handleBlockOk:function(e){null!==this.editBlockIndex?(this.form.question_block[this.editBlockIndex]=e,this.editBlockIndex=null):(e.id=Date.now(),e.questionnaire_question=[],this.form.question_block.push(e)),this.$forceUpdate()},handleAddQuestion:function(e,t){this.editQuestionIndex=null,this.$refs.createSubjectForm.add(t,e,this.form.score_correspondence,this.form.set_answer)},handleEditQuestion:function(e,t){this.editQuestionIndex=t;var n=this.form.question_block[e].questionnaire_question[t];this.$refs.createSubjectForm.edit(n,e,this.form.score_correspondence,this.form.set_answer)},handleDeleteQuestion:function(e,t){this.form.question_block[e].questionnaire_question.splice(t,1),this.$forceUpdate()},handleQuestionOk:function(e,t){var n=e.question_type;4===n?e.blank_count=this.calculateBlanks(e.stem):[3,5].includes(n)&&delete e.questionnaire_question_option,null!==this.editQuestionIndex?(this.form.question_block[t].questionnaire_question[this.editQuestionIndex]=e,this.editQuestionIndex=null):(e.id=Date.now(),this.form.question_block[t].questionnaire_question.push(e)),this.$forceUpdate()},calculateBlanks:function(e){return(e.match(/_+/g)||[]).length},handleMultipleOk:function(e){var t=this;e&&e.length&&e.forEach((function(e){t.form.question_block.push(e)}))},resetForm:function(){this.form={ysValue:[],grade:[],questionnaire_title:"",questionnaire_describe:"",set_answer:"0",score_correspondence:"0",question_block:[]}},onClose:function(){this.visible=!1,this.resetForm()},onChangeScore:function(e,t,n){var i=this,s=t.id||t.key;this.form.question_block.forEach((function(t){t.key!==s&&t.id!==s||t.questionnaire_question.forEach((function(t){i.$set(t,"score",e)}))}))}}},m=f,h=(n("d13d"),n("0c7c")),_=Object(h["a"])(m,i,s,!1,null,"69587c14",null);t["default"]=_.exports},a2e4:function(e,t,n){},ac81:function(e,t,n){"use strict";n("a2e4")},b291:function(e,t,n){"use strict";n("cad4")},cad4:function(e,t,n){},d13d:function(e,t,n){"use strict";n("3021")},d73d:function(e,t,n){"use strict";n("e2ab")},e2ab:function(e,t,n){}}]);