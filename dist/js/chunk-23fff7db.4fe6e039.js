(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-23fff7db"],{"1fb4":function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("a-modal",{attrs:{title:e.title,width:1100,confirmLoading:e.confirmLoading},on:{ok:e.handleOk},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[r("a-form-model",{ref:"ruleForm",attrs:{model:e.formContent,"label-col":e.labelCol,"wrapper-col":e.wrapperCol,rules:e.rules}},["2"===e.formContent.document_type&&["vice_principal","principal"].includes(e.formData.haveCirculationRoles.code)?r("a-form-model-item",{attrs:{label:"审批结果",prop:"approval_result"}},[r("a-radio-group",{on:{change:e.onChangeApprovalResult},model:{value:e.formContent.approval_result,callback:function(t){e.$set(e.formContent,"approval_result",t)},expression:"formContent.approval_result"}},[r("a-radio",{attrs:{value:"1"}},[e._v("通过")]),r("a-radio",{attrs:{value:"2"}},[e._v("不通过")])],1)],1):e._e(),r("a-form-model-item",{attrs:{label:"办理意见",prop:"processing_opinions"}},[r("a-textarea",{attrs:{placeholder:"请输入办理意见(最多500个字符)",allowClear:!0,"auto-size":{minRows:4}},model:{value:e.formContent.processing_opinions,callback:function(t){e.$set(e.formContent,"processing_opinions",t)},expression:"formContent.processing_opinions"}}),r("div",{staticClass:"flex jsend",staticStyle:{"margin-top":"-15px"}},[r("a-dropdown",{model:{value:e.visibleApprove,callback:function(t){e.visibleApprove=t},expression:"visibleApprove"}},[r("a",{staticClass:"ant-dropdown-link",on:{click:function(e){return e.preventDefault()}}},[e._v(" 从批语库中选择 "),r("a-icon",{attrs:{type:"down"}})],1),r("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},e._l(e.formData.approve,(function(t,o){return r("a-menu-item",{key:o,on:{click:function(r){e.formContent.processing_opinions+=t.approve_name+"、"}}},[e._v(" "+e._s(t.approve_name)+" ")])})),1)],1)],1)],1),r("a-form-model-item",{attrs:{label:"流转节点",prop:"current_step"}},[r("a-radio-group",{on:{change:e.onChangeCurrentStep},model:{value:e.formContent.current_step,callback:function(t){e.$set(e.formContent,"current_step",t)},expression:"formContent.current_step"}},e._l(e.formData.selectableRoles,(function(t,o){return r("a-radio",{key:o,attrs:{value:t.code}},[e._v(" "+e._s(t.name)+" ")])})),1)],1),"end"!==e.formContent.current_step?r("a-form-model-item",{attrs:{label:"办理人",required:""}},[r("div",{staticClass:"flex"},[r("div",{staticClass:"flex3 plr10 ptb5 w100 bde7 radius6",staticStyle:{"min-height":"240px"}},[r("a-input-search",{staticClass:"radius40 overxy ttBk",attrs:{placeholder:"输入人员姓名搜索"},on:{search:e.onSearchUserName},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),e.formData.userList.length?r("div",{staticClass:"mb10 bdbe7",staticStyle:{"margin-top":"-10px"}},[r("a-checkbox",{attrs:{checked:e.checkAll},on:{change:e.onCheckAllChange}},[e._v("全选")])],1):e._e(),e.formData.userList.length?r("div",{staticStyle:{"max-height":"300px","overflow-y":"auto"}},[r("a-checkbox-group",{staticStyle:{width:"100%"},on:{change:e.onSelUser},model:{value:e.formContent.current_personnel,callback:function(t){e.$set(e.formContent,"current_personnel",t)},expression:"formContent.current_personnel"}},[r("a-row",e._l(e.formData.userList,(function(t,o){return r("a-col",{key:o,attrs:{span:4}},[r("a-checkbox",{attrs:{value:t.id,disabled:e.formContent.current_personnel.includes(t.id)}},[e._v(" "+e._s(t.name)+" ")])],1)})),1)],1)],1):r("div",{staticClass:"flex jscenter ptb20"},[r("a-spin",{attrs:{tip:"获取数据..."}})],1)],1),r("data",{staticClass:"wt10"}),r("div",{staticClass:"flex1 pb5 w100 bde7 radius6",staticStyle:{"min-height":"240px"}},[r("div",{staticClass:"bgf6 plr10"},[e._v("已选人员：")]),e._l(e.selRoleUser,(function(t,o){return r("div",{key:o,staticClass:"bdbe7 plr10"},[r("div",{staticClass:"bold red mr5 ft12"},[e._v(e._s(t.name)+":")]),e._l(t.selUser,(function(o,n){return r("div",{key:n,staticClass:"ht30 flex between alcenter"},[r("span",[e._v(e._s(o.name))]),r("a-tag",{attrs:{color:"red"},on:{click:function(r){return e.onRemoveUser(t,o)}}},[e._v("移除")])],1)}))],2)})),e.selRoleUser.length?e._e():r("a-empty",{staticStyle:{"margin-top":"20px"},attrs:{description:"未选人员"}})],2)])]):e._e()],1)],1)],1)},n=[],a=(r("4de4"),r("b0c0"),r("7db0"),r("d81d"),r("159b"),r("caad"),r("2532"),r("99af"),r("a434"),r("4ec9"),r("d3b7"),r("3ca3"),r("ddb0"),r("a15b"),r("a6dd")),s=r("ce85"),i=r("0901"),c={data:function(){return{visibleApprove:!1,visible:!1,confirmLoading:!1,title:"办理",labelCol:{span:3},wrapperCol:{span:20},rules:{approval_result:[{required:!0,message:"请选择审批结果",trigger:"change"}],current_step:[{required:!0,message:"请选择流转节点",trigger:"change"}],processing_opinions:[{required:!0,message:"请输入办理意见",trigger:"blur"}]},formData:{haveCirculationRoles:{},selectableRoles:[],allCirculationRoles:[{code:"principal",name:"段校长",selUser:[]},{code:"vice_principal",name:"副校长、工会主席、校长助理",selUser:[]},{code:"middle_level",name:"中层",selUser:[]},{code:"director_of_office",name:"办公室主任",selUser:[]},{code:"office_archivist",name:"办公室档案员",selUser:[]},{code:"clerk",name:"文书员",selUser:[]},{code:"pt",name:"普通员工",selUser:[]}],approve:[],userList:[],userTotal:0,userPageNo:1},formContent:{approval_result:"1",processing_opinions:"",current:[],current_step:"",current_personnel:[]},username:"",checkAll:!1}},computed:{selRoleUser:function(){var e=this.formData.allCirculationRoles.filter((function(e){return e.selUser.length>0}));return e}},methods:{getApprove:function(){var e=this;Object(a["d"])({pageNo:1,pageSize:100}).then((function(t){t.success&&(e.formData.approve=t.data.rows)}))},edit:function(e){this.visible=!0,this.getApprove(),this.formData=Object.assign({},this.$options.data().formData),this.formData.haveCirculationRoles={code:e.current_step.current_step,name:e.current_step.current_step_name},this.formContent=Object.assign({},this.$options.data().formContent,e),this.formContent.previous_step=this.formData.haveCirculationRoles.code,this.formContent.previous_personnel=this.$userInfo.id,this.setTitle(),this.setShowRole()},setTitle:function(){1===this.formContent.step?"1"===this.formContent.document_type?this.title="当前节点：办公室档案员【开始】":"2"===this.formContent.document_type&&(this.title="当前节点：中层【开始】"):this.title="当前节点：".concat(this.formData.haveCirculationRoles.name)},setShowRole:function(){var e="",t=[];"1"===this.formContent.document_type?"office_archivist"===this.formData.haveCirculationRoles.code?(t=[{code:"director_of_office",name:"办公室主任"}],e="director_of_office"):"director_of_office"===this.formData.haveCirculationRoles.code?(t=[{code:"principal",name:"段校长"},{code:"vice_principal",name:"副校长、工会主席、校长助理"},{code:"middle_level",name:"中层"},{code:"pt",name:"普通员工"},{code:"end",name:"结束"}],e="principal"):"principal"===this.formData.haveCirculationRoles.code?(t=[{code:"director_of_office",name:"办公室主任"}],e="director_of_office"):"vice_principal"===this.formData.haveCirculationRoles.code?(t=[{code:"middle_level",name:"中层"},{code:"end",name:"结束"}],e="middle_level"):"middle_level"===this.formData.haveCirculationRoles.code?(t=[{code:"pt",name:"普通员工"},{code:"end",name:"结束"}],e="pt"):"pt"===this.formData.haveCirculationRoles.code&&(t=[{code:"end",name:"结束"}],e="end"):"2"===this.formContent.document_type&&("middle_level"===this.formData.haveCirculationRoles.code?(t=[{code:"vice_principal",name:"副校长、工会主席、校长助理"}],e="vice_principal"):"vice_principal"===this.formData.haveCirculationRoles.code?"1"===this.formContent.approval_result?(t=[{code:"principal",name:"段校长"}],e="principal"):(t=[{code:"middle_level",name:"中层"}],e="middle_level"):"principal"===this.formData.haveCirculationRoles.code?(t=[{code:"director_of_office",name:"办公室主任"}],e="director_of_office"):"director_of_office"===this.formData.haveCirculationRoles.code?(t=[{code:"middle_level",name:"中层"},{code:"clerk",name:"文书员"}],e="clerk"):"clerk"===this.formData.haveCirculationRoles.code&&(t=[{code:"end",name:"结束"}],e="end")),this.formData.selectableRoles=t,this.formContent.current_step=e,"end"!==e&&this.getUser({sysRoleCode:e})},onChangeApprovalResult:function(e){this.setShowRole()},onChangeCurrentStep:function(e){var t=e.target.value;"end"!==t&&this.getUser({sysRoleCode:t}),this.username=""},onSearchUserName:function(e){this.getUser({searchValue:e})},onChangeUserPage:function(e,t){this.getUser({pageNo:e})},getUser:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.formData.userList=[];var r=this.formData.allCirculationRoles.find((function(t){return t.code===e.formContent.current_step})),o={};o="1"===this.formContent.document_type&&"middle_level"===this.formData.haveCirculationRoles.code?{pageNo:1,pageSize:350,sysRoleCode:this.formContent.current_step,"sysEmpParam.orgId":this.$userInfo.loginEmpInfo.orgId}:{pageNo:1,pageSize:350,sysRoleCode:this.formContent.current_step};var n=Object.assign({},o,t);Object(i["a"])(n).then((function(t){t.success&&(e.formData.userList=t.data.rows||[],e.formData.userTotal=t.data.totalRows||0,e.formData.userPageNo=t.data.pageNo||1,r.selUser.length?e.formContent.current_personnel=r.selUser.map((function(e){return e.id})):1===e.formData.userList.length&&"2"===e.formContent.document_type&&"vice_principal"===e.formData.haveCirculationRoles.code&&"1"===e.formContent.approval_result?(e.formContent.current_personnel=[e.formData.userList[0].id],r.selUser=e.formData.userList):e.formContent.current_personnel=[],r.selUser.length===e.formData.userList.length?e.checkAll=!0:e.checkAll=!1)}))},onCheckAllChange:function(e){var t=this;this.checkAll=e.target.checked,this.checkAll?this.formContent.current_personnel=this.formData.userList.map((function(e){return e.id})):this.formContent.current_personnel=[],this.formData.allCirculationRoles.forEach((function(e){e.code===t.formContent.current_step&&(e.selUser=t.checkAll?t.formData.userList:[])}))},onSelUser:function(e){var t=this,r=this.formData.userList.filter((function(t){return e.includes(t.id)}));this.formData.allCirculationRoles.forEach((function(e){e.code===t.formContent.current_step&&(e.selUser=t.unique(e.selUser.concat(r)))}))},onRemoveUser:function(e,t){var r=this;e.selUser.forEach((function(o,n){o.id===t.id&&(e.selUser.splice(n,1),e.code===r.formContent.current_step&&(r.formContent.current_personnel=e.selUser.map((function(e){return e.id}))))}))},unique:function(e){var t=new Map;return e.filter((function(e){return!t.has(e.id)&&t.set(e.id,1)}))},handleOk:function(){var e=this;this.$refs.ruleForm.validate((function(t){if(!t||!e.check())return!1;var r=JSON.parse(JSON.stringify(e.formContent));delete r.current_step,delete r.current_personnel,e.confirmLoading=!0,Object(s["c"])(r).then((function(t){t.success?(e.visible=!1,e.$message.success("办理成功！"),e.$emit("ok")):e.$message.error(JSON.stringify(t.message)),e.confirmLoading=!1}))}))},check:function(){var e=!0;if("end"===this.formContent.current_step)this.formContent.current=[{current_step:"end",current_personnel:""}],e=!0;else if(this.selRoleUser.length){var t=[];this.selRoleUser.forEach((function(e){var r={current_step:e.code,current_personnel:e.selUser.map((function(e){return e.id})).join("|")};t.push(r)})),this.formContent.current=t,e=!0}else this.$message.error("未选择办理人"),e=!1;return e}}},l=c,u=(r("ba9b"),r("0c7c")),d=Object(u["a"])(l,o,n,!1,null,"3170b202",null);t["default"]=d.exports},a6dd:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"c",(function(){return a})),r.d(t,"b",(function(){return s})),r.d(t,"d",(function(){return i}));var o=r("b775");function n(e){return Object(o["b"])({url:"/ApproveDatabase/Create",method:"post",data:e})}function a(e){return Object(o["b"])({url:"/ApproveDatabase/Edit",method:"post",data:e})}function s(e){return Object(o["b"])({url:"/ApproveDatabase/Del",method:"post",data:e})}function i(e){return Object(o["b"])({url:"/ApproveDatabase/Get",method:"get",params:e})}},ba9b:function(e,t,r){"use strict";r("f409")},ce85:function(e,t,r){"use strict";r.d(t,"c",(function(){return n})),r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s}));var o=r("b775");function n(e){return Object(o["b"])({url:"/CirculationLog/Update",method:"post",data:e})}function a(e){return Object(o["b"])({url:"/CirculationLog/Get",method:"get",params:e})}function s(e){return Object(o["b"])({url:"/CirculationLog/GetMyDo",method:"get",params:e})}},f409:function(e,t,r){}}]);