(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0aadb1"],{1392:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-card",{staticClass:"cardshadow",attrs:{bordered:!1}},[a("a-divider",[t._v("申请报告厅")]),a("div",{staticClass:"ht10"}),a("a-form-model",{ref:"ruleForm",attrs:{model:t.formContent,"label-col":t.labelCol,"wrapper-col":t.wrapperCol,rules:t.rules}},[a("a-form-model-item",{attrs:{label:"申请人",prop:"applicant"}},[a("HyUserSelect",{attrs:{choiceType:"radio"},model:{value:t.formContent.applicant,callback:function(e){t.$set(t.formContent,"applicant",e)},expression:"formContent.applicant"}})],1),a("a-form-model-item",{attrs:{label:"报告厅",prop:"lecture_hall_id"}},[a("SelLectureHall",{on:{change:t.onChangeLectureHall},model:{value:t.formContent.lecture_hall_id,callback:function(e){t.$set(t.formContent,"lecture_hall_id",e)},expression:"formContent.lecture_hall_id"}})],1),a("a-form-model-item",{attrs:{label:"申请日期",prop:"date"}},[a("a-date-picker",{staticStyle:{width:"100%"},attrs:{valueFormat:"YYYY-MM-DD"},on:{change:t.onChangeDate},model:{value:t.formContent.date,callback:function(e){t.$set(t.formContent,"date",e)},expression:"formContent.date"}})],1),a("a-form-model-item",{attrs:{label:"申请时间段",prop:"time_slot_ids"}},[t.formContent.lecture_hall_id?a("div",{staticClass:"plr10 ptb10 w100 bde7 radius6"},[t.formData.time_slot.length?a("div",[a("a-checkbox-group",{staticStyle:{width:"100%"},model:{value:t.formContent.time_slot_ids,callback:function(e){t.$set(t.formContent,"time_slot_ids",e)},expression:"formContent.time_slot_ids"}},[a("a-row",t._l(t.formData.time_slot,(function(e,o){return a("a-col",{key:o,attrs:{span:8}},[a("a-checkbox",{attrs:{value:e.id,disabled:e.disabled}},[t._v(" "+t._s(e.time_start.split(" ")[1])+" - "+t._s(e.time_end.split(" ")[1])+" ")])],1)})),1)],1)],1):a("div",{staticClass:"flex jscenter ptb20"},[a("a-spin",{attrs:{tip:"获取数据..."}})],1)]):a("div",{staticClass:"plr10 ptb20 w100 bde7 radius6 flex jscenter alcenter"},[a("a-empty",{attrs:{description:"请先选择报告厅"}})],1)]),a("a-form-model-item",{attrs:{label:"申请理由",prop:"reason"}},[a("a-textarea",{attrs:{placeholder:"请输入",allowClear:!0,"auto-size":{minRows:4}},model:{value:t.formContent.reason,callback:function(e){t.$set(t.formContent,"reason",e)},expression:"formContent.reason"}})],1)],1),a("div",{staticClass:"w20 mt20 mauto"},[a("a-button",{attrs:{loading:t.confirmLoading,type:"primary",icon:"check",shape:"round",block:""},on:{click:t.handleOk}},[t._v(" 提交 ")])],1)],1)],1)},i=[],r=(a("159b"),a("caad"),a("2532"),a("a15b"),a("0d83")),n=a("0aa2"),s=a("ca35"),l={components:{SelLectureHall:s["default"]},data:function(){return{confirmLoading:!1,labelCol:{span:4},wrapperCol:{span:18},rules:{reason:[{required:!0,message:"请输入申请理由",trigger:"blur"}],applicant:[{required:!0,message:"请选择申请人",trigger:"change"}],lecture_hall_id:[{required:!0,message:"请选择申请报告厅",trigger:"change"}],date:[{required:!0,message:"请选择申请日期",trigger:"change"}],time_slot_ids:[{required:!0,message:"请选择申请时间段",trigger:"change"}]},formData:{time_slot:[]},formContent:{date:"",applicant:"",time_slot_ids:[]}}},created:function(){this.add()},methods:{getTimeSlot:function(t){var e=this;Object(r["d"])({pageNo:1,pageSize:500,lecture_hall_id:t}).then((function(t){t.success&&(e.formData.time_slot=t.data.rows,e.formContent.date&&e.getTimeApplied({lecture_hall_id:e.formContent.lecture_hall_id,date:e.formContent.date}))}))},getTimeApplied:function(t){var e=this;Object(n["g"])(t).then((function(t){if(t.success){var a=t.data||[];e.formData.time_slot.forEach((function(t){a.includes(t.id)?e.$set(t,"disabled",!0):e.$set(t,"disabled",!1)}))}}))},onChangeLectureHall:function(t){t?this.getTimeSlot(t):this.formData.time_slot=[],this.formContent.time_slot_ids=[]},onChangeDate:function(t){t&&this.formContent.lecture_hall_id&&this.getTimeApplied({lecture_hall_id:this.formContent.lecture_hall_id,date:t}),this.formContent.time_slot_ids=[]},add:function(){this.formContent=Object.assign({},this.$options.data().formContent),this.formContent.applicant=this.$userInfo.id},handleOk:function(){var t=this;this.$refs.ruleForm.validate((function(e){if(!e)return!1;var a=JSON.parse(JSON.stringify(t.formContent));!a.time_slot_ids||Array.isArray(a.time_slot_ids)&&!a.time_slot_ids.length?delete a.time_slot_ids:a.time_slot_ids=Array.isArray(a.time_slot_ids)?a.time_slot_ids.join("|"):a.time_slot_ids,t.confirmLoading=!0,Object(n["a"])(a).then((function(e){e.success?(t.$message.success("提交成功！"),t.formContent=Object.assign({},t.$options.data().formContent)):t.$message.error(JSON.stringify(e.message)),t.confirmLoading=!1}))}))}}},d=l,c=a("0c7c"),m=Object(c["a"])(d,o,i,!1,null,null,null);e["default"]=m.exports}}]);